import{p as rt,aq as Dt,C as nt,V as He,a as Gt,a1 as lt,aC as Ot,aw as At,av as It,aD as Bt,D as St,aE as Pt,aF as ut,aG as Rt,J as Mt,Q as Et,d as at,o as ot,B as Lt,aH as Wt}from"./three-ddfced5c.js";import{d as qe,t as zt}from"./troika-worker-utils-1eb8acfa.js";import{S as Ut}from"./webgl-sdf-generator-c9ead90a.js";import{b as Vt}from"./bidi-js-b480259a.js";import{c as Nt,v as jt}from"./troika-three-utils-174cfc43.js";function Xt(y,o,v){const{defaultFontURL:c}=v,t=Object.create(null),e=1/0,a=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,n="[^\\S\\u00A0]",r=new RegExp(`${n}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function i(h,U){function T(){const S=b=>{console.error(`Failure loading font ${h}${h===c?"":"; trying fallback"}`,b),h!==c&&(h=c,T())};try{const b=new XMLHttpRequest;b.open("get",h,!0),b.responseType="arraybuffer",b.onload=function(){if(b.status>=400)S(new Error(b.statusText));else if(b.status>0)try{const F=y(b.response);U(F)}catch(F){S(F)}},b.onerror=S,b.send()}catch(b){S(b)}}T()}function s(h,U){h||(h=c);let T=t[h];T?T.pending?T.pending.push(U):U(T):(t[h]={pending:[U]},i(h,S=>{let b=t[h].pending;t[h]=S,b.forEach(F=>F(S))}))}function l({text:h="",font:U=c,sdfGlyphSize:T=64,fontSize:S=1,letterSpacing:b=0,lineHeight:F="normal",maxWidth:k=e,direction:A,textAlign:O="left",textIndent:B=0,whiteSpace:m="normal",overflowWrap:w="normal",anchorX:C=0,anchorY:_=0,includeCaretPositions:D=!1,chunkedBoundsSize:P=8192,colorRanges:R=null},W,Y=!1){const G=p(),E={fontLoad:0,typesetting:0};h.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),h=h.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),S=+S,b=+b,k=+k,F=F||"normal",B=+B,s(U,M=>{const X=isFinite(k);let Q=null,K=null,oe=null,H=null,$=null,V=null,I=null,z=0,fe=0,re=m!=="nowrap";const{ascender:N,descender:ne,unitsPerEm:Oe,lineGap:Ye,capHeight:Ee,xHeight:ve}=M;E.fontLoad=p()-G;const Le=p(),q=S/Oe;F==="normal"&&(F=(N-ne+Ye)/Oe),F=F*S;const De=(F-(N-ne)*q)/2,ke=-(N*q+De),Se=Math.min(F,(N-ne)*q),$e=(N+ne)/2*q-Se/2;let Fe=B,se=new d;const de=[se];M.forEachGlyph(h,S,b,(L,le,be)=>{const j=h.charAt(be),ee=L.advanceWidth*q,ie=se.count;let ue;if("isEmpty"in L||(L.isWhitespace=!!j&&new RegExp(n).test(j),L.canBreakAfter=!!j&&r.test(j),L.isEmpty=L.xMin===L.xMax||L.yMin===L.yMax||a.test(j)),!L.isWhitespace&&!L.isEmpty&&fe++,re&&X&&!L.isWhitespace&&le+ee+Fe>k&&ie){if(se.glyphAt(ie-1).glyphObj.canBreakAfter)ue=new d,Fe=-le;else for(let Pe=ie;Pe--;)if(Pe===0&&w==="break-word"){ue=new d,Fe=-le;break}else if(se.glyphAt(Pe).glyphObj.canBreakAfter){ue=se.splitAt(Pe+1);const ye=ue.glyphAt(0).x;Fe-=ye;for(let Ae=ue.count;Ae--;)ue.glyphAt(Ae).x-=ye;break}ue&&(se.isSoftWrapped=!0,se=ue,de.push(se),z=k)}let Z=se.glyphAt(se.count);Z.glyphObj=L,Z.x=le+Fe,Z.width=ee,Z.charIndex=be,j===`
`&&(se=new d,de.push(se),Fe=-(le+ee+b*S)+B)}),de.forEach(L=>{for(let le=L.count;le--;){let{glyphObj:be,x:j,width:ee}=L.glyphAt(le);if(!be.isWhitespace){L.width=j+ee,L.width>z&&(z=L.width);return}}});let Ue=0,ge=0;if(C&&(typeof C=="number"?Ue=-C:typeof C=="string"&&(Ue=-z*(C==="left"?0:C==="center"?.5:C==="right"?1:f(C)))),_){if(typeof _=="number")ge=-_;else if(typeof _=="string"){let L=de.length*F;ge=_==="top"?0:_==="top-baseline"?-ke:_==="top-cap"?-ke-Ee*q:_==="top-ex"?-ke-ve*q:_==="middle"?L/2:_==="bottom"?L:_==="bottom-baseline"?L-De+ne*q:f(_)*L}}if(!Y){const L=o.getEmbeddingLevels(h,A);Q=new Uint16Array(fe),K=new Float32Array(fe*2),oe={},V=[e,e,-e,-e],I=[];let le=ke;D&&($=new Float32Array(h.length*3)),R&&(H=new Uint8Array(fe*3));let be=0,j=-1,ee=-1,ie,ue;if(de.forEach((Z,Pe)=>{let{count:ye,width:Ae}=Z;if(ye>0){let We=0;for(let ae=ye;ae--&&Z.glyphAt(ae).glyphObj.isWhitespace;)We++;let ze=0,Re=0;if(O==="center")ze=(z-Ae)/2;else if(O==="right")ze=z-Ae;else if(O==="justify"&&Z.isSoftWrapped){let ae=0;for(let te=ye-We;te--;)Z.glyphAt(te).glyphObj.isWhitespace&&ae++;Re=(z-Ae)/ae}if(Re||ze){let ae=0;for(let te=0;te<ye;te++){let Te=Z.glyphAt(te);const xe=Te.glyphObj;Te.x+=ze+ae,Re!==0&&xe.isWhitespace&&te<ye-We&&(ae+=Re,Te.width+=Re)}}const st=o.getReorderSegments(h,L,Z.glyphAt(0).charIndex,Z.glyphAt(Z.count-1).charIndex);for(let ae=0;ae<st.length;ae++){const[te,Te]=st[ae];let xe=1/0,J=-1/0;for(let me=0;me<ye;me++)if(Z.glyphAt(me).charIndex>=te){let Ce=me,ce=me;for(;ce<ye;ce++){let pe=Z.glyphAt(ce);if(pe.charIndex>Te)break;ce<ye-We&&(xe=Math.min(xe,pe.x),J=Math.max(J,pe.x+pe.width))}for(let pe=Ce;pe<ce;pe++){const we=Z.glyphAt(pe);we.x=J-(we.x+we.width-xe)}break}}let he;const _t=ae=>he=ae;for(let ae=0;ae<ye;ae++){let te=Z.glyphAt(ae);he=te.glyphObj;const Te=he.index,xe=L.levels[te.charIndex]&1;if(xe){const J=o.getMirroredCharacter(h[te.charIndex]);J&&M.forEachGlyph(J,0,0,_t)}if(D){const{charIndex:J}=te,me=te.x+Ue,Ce=te.x+te.width+Ue;$[J*3]=xe?Ce:me,$[J*3+1]=xe?me:Ce,$[J*3+2]=le+$e+ge;const ce=J-j;ce>1&&g($,j,ce),j=J}if(R){const{charIndex:J}=te;for(;J>ee;)ee++,R.hasOwnProperty(ee)&&(ue=R[ee])}if(!he.isWhitespace&&!he.isEmpty){const J=be++;oe[Te]||(oe[Te]={path:he.path,pathBounds:[he.xMin,he.yMin,he.xMax,he.yMax]});const me=te.x+Ue,Ce=le+ge;K[J*2]=me,K[J*2+1]=Ce;const ce=me+he.xMin*q,pe=Ce+he.yMin*q,we=me+he.xMax*q,Ve=Ce+he.yMax*q;ce<V[0]&&(V[0]=ce),pe<V[1]&&(V[1]=pe),we>V[2]&&(V[2]=we),Ve>V[3]&&(V[3]=Ve),J%P===0&&(ie={start:J,end:J,rect:[e,e,-e,-e]},I.push(ie)),ie.end++;const _e=ie.rect;if(ce<_e[0]&&(_e[0]=ce),pe<_e[1]&&(_e[1]=pe),we>_e[2]&&(_e[2]=we),Ve>_e[3]&&(_e[3]=Ve),Q[J]=Te,R){const Qe=J*3;H[Qe]=ue>>16&255,H[Qe+1]=ue>>8&255,H[Qe+2]=ue&255}}}}le-=F}),$){const Z=h.length-j;Z>1&&g($,j,Z)}}E.typesetting=p()-Le,W({glyphIds:Q,glyphPositions:K,glyphData:oe,caretPositions:$,caretHeight:Se,glyphColors:H,chunkedBounds:I,fontSize:S,unitsPerEm:Oe,ascender:N*q,descender:ne*q,capHeight:Ee*q,xHeight:ve*q,lineHeight:F,topBaseline:ke,blockBounds:[Ue,ge-de.length*F,Ue+z,ge],visibleBounds:V,timings:E})})}function u(h,U){l(h,T=>{const[S,b,F,k]=T.blockBounds;U({width:F-S,height:k-b})},{metricsOnly:!0})}function f(h){let U=h.match(/^([\d.]+)%$/),T=U?parseFloat(U[1]):NaN;return isNaN(T)?0:T/100}function g(h,U,T){const S=h[U*3],b=h[U*3+1],F=h[U*3+2],k=(b-S)/T;for(let A=0;A<T;A++){const O=(U+A)*3;h[O]=S+k*A,h[O+1]=S+k*(A+1),h[O+2]=F}}function p(){return(self.performance||Date).now()}function d(){this.data=[]}const x=["glyphObj","x","width","charIndex"];return d.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/x.length)},glyphAt(h){let U=d.flyweight;return U.data=this.data,U.index=h,U},splitAt(h){let U=new d;return U.data=this.data.splice(h*x.length),U}},d.flyweight=x.reduce((h,U,T,S)=>(Object.defineProperty(h,U,{get(){return this.data[this.index*x.length+T]},set(b){this.data[this.index*x.length+T]=b}}),h),{data:null,index:0}),{typeset:l,measure:u,loadFont:s}}const Ge=()=>(self.performance||Date).now(),Je=Ut();let ft;function Ht(y,o,v,c,t,e,a,n,r,i,s=!0){return s?Jt(y,o,v,c,t,e,a,n,r,i).then(null,l=>(ft||(console.warn("WebGL SDF generation failed, falling back to JS",l),ft=!0),dt(y,o,v,c,t,e,a,n,r,i))):dt(y,o,v,c,t,e,a,n,r,i)}const Xe=[],qt=5;let tt=0;function bt(){const y=Ge();for(;Xe.length&&Ge()-y<qt;)Xe.shift()();tt=Xe.length?setTimeout(bt,0):0}const Jt=(...y)=>new Promise((o,v)=>{Xe.push(()=>{const c=Ge();try{Je.webgl.generateIntoCanvas(...y),o({timing:Ge()-c})}catch(t){v(t)}}),tt||(tt=setTimeout(bt,0))}),Yt=4,$t=2e3,ht={};let Qt=0;function dt(y,o,v,c,t,e,a,n,r,i){const s="TroikaTextSDFGenerator_JS_"+Qt++%Yt;let l=ht[s];return l||(l=ht[s]={workerModule:qe({name:s,workerId:s,dependencies:[Ut,Ge],init(u,f){const g=u().javascript.generate;return function(...p){const d=f();return{textureData:g(...p),timing:f()-d}}},getTransferables(u){return[u.textureData.buffer]}}),requests:0,idleTimer:null}),l.requests++,clearTimeout(l.idleTimer),l.workerModule(y,o,v,c,t,e).then(({textureData:u,timing:f})=>{const g=Ge(),p=new Uint8Array(u.length*4);for(let d=0;d<u.length;d++)p[d*4+i]=u[d];return Je.webglUtils.renderImageData(a,p,n,r,y,o,1<<3-i),f+=Ge()-g,--l.requests===0&&(l.idleTimer=setTimeout(()=>{zt(s)},$t)),{timing:f}})}function Zt(y){y._warm||(Je.webgl.isSupported(y),y._warm=!0)}const Kt=Je.webglUtils.resizeWebGLCanvasWithoutClearing;/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function er(){return typeof window>"u"&&(self.window=self),function(y){var o={parse:function(t){var e=o._bin,a=new Uint8Array(t);if(e.readASCII(a,0,4)=="ttcf"){var n=4;e.readUshort(a,n),n+=2,e.readUshort(a,n),n+=2;var r=e.readUint(a,n);n+=4;for(var i=[],s=0;s<r;s++){var l=e.readUint(a,n);n+=4,i.push(o._readFont(a,l))}return i}return[o._readFont(a,0)]},_readFont:function(t,e){var a=o._bin,n=e;a.readFixed(t,e),e+=4;var r=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2;for(var i=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],s={_data:t,_offset:n},l={},u=0;u<r;u++){var f=a.readASCII(t,e,4);e+=4,a.readUint(t,e),e+=4;var g=a.readUint(t,e);e+=4;var p=a.readUint(t,e);e+=4,l[f]={offset:g,length:p}}for(u=0;u<i.length;u++){var d=i[u];l[d]&&(s[d.trim()]=o[d.trim()].parse(t,l[d].offset,l[d].length,s))}return s},_tabOffset:function(t,e,a){for(var n=o._bin,r=n.readUshort(t,a+4),i=a+12,s=0;s<r;s++){var l=n.readASCII(t,i,4);i+=4,n.readUint(t,i),i+=4;var u=n.readUint(t,i);if(i+=4,n.readUint(t,i),i+=4,l==e)return u}return 0}};o._bin={readFixed:function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<8|t[e+3])/65540},readF2dot14:function(t,e){return o._bin.readShort(t,e)/16384},readInt:function(t,e){return o._bin._view(t).getInt32(e)},readInt8:function(t,e){return o._bin._view(t).getInt8(e)},readShort:function(t,e){return o._bin._view(t).getInt16(e)},readUshort:function(t,e){return o._bin._view(t).getUint16(e)},readUshorts:function(t,e,a){for(var n=[],r=0;r<a;r++)n.push(o._bin.readUshort(t,e+2*r));return n},readUint:function(t,e){return o._bin._view(t).getUint32(e)},readUint64:function(t,e){return 4294967296*o._bin.readUint(t,e)+o._bin.readUint(t,e+4)},readASCII:function(t,e,a){for(var n="",r=0;r<a;r++)n+=String.fromCharCode(t[e+r]);return n},readUnicode:function(t,e,a){for(var n="",r=0;r<a;r++){var i=t[e++]<<8|t[e++];n+=String.fromCharCode(i)}return n},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,e,a){var n=o._bin._tdec;return n&&e==0&&a==t.length?n.decode(t):o._bin.readASCII(t,e,a)},readBytes:function(t,e,a){for(var n=[],r=0;r<a;r++)n.push(t[e+r]);return n},readASCIIArray:function(t,e,a){for(var n=[],r=0;r<a;r++)n.push(String.fromCharCode(t[e+r]));return n},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},o._lctf={},o._lctf.parse=function(t,e,a,n,r){var i=o._bin,s={},l=e;i.readFixed(t,e),e+=4;var u=i.readUshort(t,e);e+=2;var f=i.readUshort(t,e);e+=2;var g=i.readUshort(t,e);return e+=2,s.scriptList=o._lctf.readScriptList(t,l+u),s.featureList=o._lctf.readFeatureList(t,l+f),s.lookupList=o._lctf.readLookupList(t,l+g,r),s},o._lctf.readLookupList=function(t,e,a){var n=o._bin,r=e,i=[],s=n.readUshort(t,e);e+=2;for(var l=0;l<s;l++){var u=n.readUshort(t,e);e+=2;var f=o._lctf.readLookupTable(t,r+u,a);i.push(f)}return i},o._lctf.readLookupTable=function(t,e,a){var n=o._bin,r=e,i={tabs:[]};i.ltype=n.readUshort(t,e),e+=2,i.flag=n.readUshort(t,e),e+=2;var s=n.readUshort(t,e);e+=2;for(var l=i.ltype,u=0;u<s;u++){var f=n.readUshort(t,e);e+=2;var g=a(t,l,r+f,i);i.tabs.push(g)}return i},o._lctf.numOfOnes=function(t){for(var e=0,a=0;a<32;a++)t>>>a&1&&e++;return e},o._lctf.readClassDef=function(t,e){var a=o._bin,n=[],r=a.readUshort(t,e);if(e+=2,r==1){var i=a.readUshort(t,e);e+=2;var s=a.readUshort(t,e);e+=2;for(var l=0;l<s;l++)n.push(i+l),n.push(i+l),n.push(a.readUshort(t,e)),e+=2}if(r==2){var u=a.readUshort(t,e);for(e+=2,l=0;l<u;l++)n.push(a.readUshort(t,e)),e+=2,n.push(a.readUshort(t,e)),e+=2,n.push(a.readUshort(t,e)),e+=2}return n},o._lctf.getInterval=function(t,e){for(var a=0;a<t.length;a+=3){var n=t[a],r=t[a+1];if(t[a+2],n<=e&&e<=r)return a}return-1},o._lctf.readCoverage=function(t,e){var a=o._bin,n={};n.fmt=a.readUshort(t,e),e+=2;var r=a.readUshort(t,e);return e+=2,n.fmt==1&&(n.tab=a.readUshorts(t,e,r)),n.fmt==2&&(n.tab=a.readUshorts(t,e,3*r)),n},o._lctf.coverageIndex=function(t,e){var a=t.tab;if(t.fmt==1)return a.indexOf(e);if(t.fmt==2){var n=o._lctf.getInterval(a,e);if(n!=-1)return a[n+2]+(e-a[n])}return-1},o._lctf.readFeatureList=function(t,e){var a=o._bin,n=e,r=[],i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var l=a.readASCII(t,e,4);e+=4;var u=a.readUshort(t,e);e+=2;var f=o._lctf.readFeatureTable(t,n+u);f.tag=l.trim(),r.push(f)}return r},o._lctf.readFeatureTable=function(t,e){var a=o._bin,n=e,r={},i=a.readUshort(t,e);e+=2,i>0&&(r.featureParams=n+i);var s=a.readUshort(t,e);e+=2,r.tab=[];for(var l=0;l<s;l++)r.tab.push(a.readUshort(t,e+2*l));return r},o._lctf.readScriptList=function(t,e){var a=o._bin,n=e,r={},i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var l=a.readASCII(t,e,4);e+=4;var u=a.readUshort(t,e);e+=2,r[l.trim()]=o._lctf.readScriptTable(t,n+u)}return r},o._lctf.readScriptTable=function(t,e){var a=o._bin,n=e,r={},i=a.readUshort(t,e);e+=2,r.default=o._lctf.readLangSysTable(t,n+i);var s=a.readUshort(t,e);e+=2;for(var l=0;l<s;l++){var u=a.readASCII(t,e,4);e+=4;var f=a.readUshort(t,e);e+=2,r[u.trim()]=o._lctf.readLangSysTable(t,n+f)}return r},o._lctf.readLangSysTable=function(t,e){var a=o._bin,n={};a.readUshort(t,e),e+=2,n.reqFeature=a.readUshort(t,e),e+=2;var r=a.readUshort(t,e);return e+=2,n.features=a.readUshorts(t,e,r),n},o.CFF={},o.CFF.parse=function(t,e,a){var n=o._bin;(t=new Uint8Array(t.buffer,e,a))[e=0],t[++e],t[++e],t[++e],e++;var r=[];e=o.CFF.readIndex(t,e,r);for(var i=[],s=0;s<r.length-1;s++)i.push(n.readASCII(t,e+r[s],r[s+1]-r[s]));e+=r[r.length-1];var l=[];e=o.CFF.readIndex(t,e,l);var u=[];for(s=0;s<l.length-1;s++)u.push(o.CFF.readDict(t,e+l[s],e+l[s+1]));e+=l[l.length-1];var f=u[0],g=[];e=o.CFF.readIndex(t,e,g);var p=[];for(s=0;s<g.length-1;s++)p.push(n.readASCII(t,e+g[s],g[s+1]-g[s]));if(e+=g[g.length-1],o.CFF.readSubrs(t,e,f),f.CharStrings){e=f.CharStrings,g=[],e=o.CFF.readIndex(t,e,g);var d=[];for(s=0;s<g.length-1;s++)d.push(n.readBytes(t,e+g[s],g[s+1]-g[s]));f.CharStrings=d}if(f.ROS){e=f.FDArray;var x=[];for(e=o.CFF.readIndex(t,e,x),f.FDArray=[],s=0;s<x.length-1;s++){var h=o.CFF.readDict(t,e+x[s],e+x[s+1]);o.CFF._readFDict(t,h,p),f.FDArray.push(h)}e+=x[x.length-1],e=f.FDSelect,f.FDSelect=[];var U=t[e];if(e++,U!=3)throw U;var T=n.readUshort(t,e);for(e+=2,s=0;s<T+1;s++)f.FDSelect.push(n.readUshort(t,e),t[e+2]),e+=3}return f.Encoding&&(f.Encoding=o.CFF.readEncoding(t,f.Encoding,f.CharStrings.length)),f.charset&&(f.charset=o.CFF.readCharset(t,f.charset,f.CharStrings.length)),o.CFF._readFDict(t,f,p),f},o.CFF._readFDict=function(t,e,a){var n;for(var r in e.Private&&(n=e.Private[1],e.Private=o.CFF.readDict(t,n,n+e.Private[0]),e.Private.Subrs&&o.CFF.readSubrs(t,n+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(r)!=-1&&(e[r]=a[e[r]-426+35])},o.CFF.readSubrs=function(t,e,a){var n=o._bin,r=[];e=o.CFF.readIndex(t,e,r);var i,s=r.length;i=s<1240?107:s<33900?1131:32768,a.Bias=i,a.Subrs=[];for(var l=0;l<r.length-1;l++)a.Subrs.push(n.readBytes(t,e+r[l],r[l+1]-r[l]))},o.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],o.CFF.glyphByUnicode=function(t,e){for(var a=0;a<t.charset.length;a++)if(t.charset[a]==e)return a;return-1},o.CFF.glyphBySE=function(t,e){return e<0||e>255?-1:o.CFF.glyphByUnicode(t,o.CFF.tableSE[e])},o.CFF.readEncoding=function(t,e,a){o._bin;var n=[".notdef"],r=t[e];if(e++,r!=0)throw"error: unknown encoding format: "+r;var i=t[e];e++;for(var s=0;s<i;s++)n.push(t[e+s]);return n},o.CFF.readCharset=function(t,e,a){var n=o._bin,r=[".notdef"],i=t[e];if(e++,i==0)for(var s=0;s<a;s++){var l=n.readUshort(t,e);e+=2,r.push(l)}else{if(i!=1&&i!=2)throw"error: format: "+i;for(;r.length<a;){l=n.readUshort(t,e),e+=2;var u=0;for(i==1?(u=t[e],e++):(u=n.readUshort(t,e),e+=2),s=0;s<=u;s++)r.push(l),l++}}return r},o.CFF.readIndex=function(t,e,a){var n=o._bin,r=n.readUshort(t,e)+1,i=t[e+=2];if(e++,i==1)for(var s=0;s<r;s++)a.push(t[e+s]);else if(i==2)for(s=0;s<r;s++)a.push(n.readUshort(t,e+2*s));else if(i==3)for(s=0;s<r;s++)a.push(16777215&n.readUint(t,e+3*s-1));else if(r!=1)throw"unsupported offset size: "+i+", count: "+r;return(e+=r*i)-1},o.CFF.getCharString=function(t,e,a){var n=o._bin,r=t[e],i=t[e+1];t[e+2],t[e+3],t[e+4];var s=1,l=null,u=null;r<=20&&(l=r,s=1),r==12&&(l=100*r+i,s=2),21<=r&&r<=27&&(l=r,s=1),r==28&&(u=n.readShort(t,e+1),s=3),29<=r&&r<=31&&(l=r,s=1),32<=r&&r<=246&&(u=r-139,s=1),247<=r&&r<=250&&(u=256*(r-247)+i+108,s=2),251<=r&&r<=254&&(u=256*-(r-251)-i-108,s=2),r==255&&(u=n.readInt(t,e+1)/65535,s=5),a.val=u??"o"+l,a.size=s},o.CFF.readCharString=function(t,e,a){for(var n=e+a,r=o._bin,i=[];e<n;){var s=t[e],l=t[e+1];t[e+2],t[e+3],t[e+4];var u=1,f=null,g=null;s<=20&&(f=s,u=1),s==12&&(f=100*s+l,u=2),s!=19&&s!=20||(f=s,u=2),21<=s&&s<=27&&(f=s,u=1),s==28&&(g=r.readShort(t,e+1),u=3),29<=s&&s<=31&&(f=s,u=1),32<=s&&s<=246&&(g=s-139,u=1),247<=s&&s<=250&&(g=256*(s-247)+l+108,u=2),251<=s&&s<=254&&(g=256*-(s-251)-l-108,u=2),s==255&&(g=r.readInt(t,e+1)/65535,u=5),i.push(g??"o"+f),e+=u}return i},o.CFF.readDict=function(t,e,a){for(var n=o._bin,r={},i=[];e<a;){var s=t[e],l=t[e+1];t[e+2],t[e+3],t[e+4];var u=1,f=null,g=null;if(s==28&&(g=n.readShort(t,e+1),u=3),s==29&&(g=n.readInt(t,e+1),u=5),32<=s&&s<=246&&(g=s-139,u=1),247<=s&&s<=250&&(g=256*(s-247)+l+108,u=2),251<=s&&s<=254&&(g=256*-(s-251)-l-108,u=2),s==255)throw g=n.readInt(t,e+1)/65535,u=5,"unknown number";if(s==30){var p=[];for(u=1;;){var d=t[e+u];u++;var x=d>>4,h=15&d;if(x!=15&&p.push(x),h!=15&&p.push(h),h==15)break}for(var U="",T=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],S=0;S<p.length;S++)U+=T[p[S]];g=parseFloat(U)}s<=21&&(f=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],u=1,s==12&&(f=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],u=2)),f!=null?(r[f]=i.length==1?i[0]:i,i=[]):i.push(g),e+=u}return r},o.cmap={},o.cmap.parse=function(t,e,a){t=new Uint8Array(t.buffer,e,a),e=0;var n=o._bin,r={};n.readUshort(t,e),e+=2;var i=n.readUshort(t,e);e+=2;var s=[];r.tables=[];for(var l=0;l<i;l++){var u=n.readUshort(t,e);e+=2;var f=n.readUshort(t,e);e+=2;var g=n.readUint(t,e);e+=4;var p="p"+u+"e"+f,d=s.indexOf(g);if(d==-1){var x;d=r.tables.length,s.push(g);var h=n.readUshort(t,g);h==0?x=o.cmap.parse0(t,g):h==4?x=o.cmap.parse4(t,g):h==6?x=o.cmap.parse6(t,g):h==12?x=o.cmap.parse12(t,g):console.debug("unknown format: "+h,u,f,g),r.tables.push(x)}if(r[p]!=null)throw"multiple tables for one platform+encoding";r[p]=d}return r},o.cmap.parse0=function(t,e){var a=o._bin,n={};n.format=a.readUshort(t,e),e+=2;var r=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2,n.map=[];for(var i=0;i<r-6;i++)n.map.push(t[e+i]);return n},o.cmap.parse4=function(t,e){var a=o._bin,n=e,r={};r.format=a.readUshort(t,e),e+=2;var i=a.readUshort(t,e);e+=2,a.readUshort(t,e),e+=2;var s=a.readUshort(t,e);e+=2;var l=s/2;r.searchRange=a.readUshort(t,e),e+=2,r.entrySelector=a.readUshort(t,e),e+=2,r.rangeShift=a.readUshort(t,e),e+=2,r.endCount=a.readUshorts(t,e,l),e+=2*l,e+=2,r.startCount=a.readUshorts(t,e,l),e+=2*l,r.idDelta=[];for(var u=0;u<l;u++)r.idDelta.push(a.readShort(t,e)),e+=2;for(r.idRangeOffset=a.readUshorts(t,e,l),e+=2*l,r.glyphIdArray=[];e<n+i;)r.glyphIdArray.push(a.readUshort(t,e)),e+=2;return r},o.cmap.parse6=function(t,e){var a=o._bin,n={};n.format=a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,a.readUshort(t,e),e+=2,n.firstCode=a.readUshort(t,e),e+=2;var r=a.readUshort(t,e);e+=2,n.glyphIdArray=[];for(var i=0;i<r;i++)n.glyphIdArray.push(a.readUshort(t,e)),e+=2;return n},o.cmap.parse12=function(t,e){var a=o._bin,n={};n.format=a.readUshort(t,e),e+=2,e+=2,a.readUint(t,e),e+=4,a.readUint(t,e),e+=4;var r=a.readUint(t,e);e+=4,n.groups=[];for(var i=0;i<r;i++){var s=e+12*i,l=a.readUint(t,s+0),u=a.readUint(t,s+4),f=a.readUint(t,s+8);n.groups.push([l,u,f])}return n},o.glyf={},o.glyf.parse=function(t,e,a,n){for(var r=[],i=0;i<n.maxp.numGlyphs;i++)r.push(null);return r},o.glyf._parseGlyf=function(t,e){var a=o._bin,n=t._data,r=o._tabOffset(n,"glyf",t._offset)+t.loca[e];if(t.loca[e]==t.loca[e+1])return null;var i={};if(i.noc=a.readShort(n,r),r+=2,i.xMin=a.readShort(n,r),r+=2,i.yMin=a.readShort(n,r),r+=2,i.xMax=a.readShort(n,r),r+=2,i.yMax=a.readShort(n,r),r+=2,i.xMin>=i.xMax||i.yMin>=i.yMax)return null;if(i.noc>0){i.endPts=[];for(var s=0;s<i.noc;s++)i.endPts.push(a.readUshort(n,r)),r+=2;var l=a.readUshort(n,r);if(r+=2,n.length-r<l)return null;i.instructions=a.readBytes(n,r,l),r+=l;var u=i.endPts[i.noc-1]+1;for(i.flags=[],s=0;s<u;s++){var f=n[r];if(r++,i.flags.push(f),(8&f)!=0){var g=n[r];r++;for(var p=0;p<g;p++)i.flags.push(f),s++}}for(i.xs=[],s=0;s<u;s++){var d=(2&i.flags[s])!=0,x=(16&i.flags[s])!=0;d?(i.xs.push(x?n[r]:-n[r]),r++):x?i.xs.push(0):(i.xs.push(a.readShort(n,r)),r+=2)}for(i.ys=[],s=0;s<u;s++)d=(4&i.flags[s])!=0,x=(32&i.flags[s])!=0,d?(i.ys.push(x?n[r]:-n[r]),r++):x?i.ys.push(0):(i.ys.push(a.readShort(n,r)),r+=2);var h=0,U=0;for(s=0;s<u;s++)h+=i.xs[s],U+=i.ys[s],i.xs[s]=h,i.ys[s]=U}else{var T;i.parts=[];do{T=a.readUshort(n,r),r+=2;var S={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(i.parts.push(S),S.glyphIndex=a.readUshort(n,r),r+=2,1&T){var b=a.readShort(n,r);r+=2;var F=a.readShort(n,r);r+=2}else b=a.readInt8(n,r),r++,F=a.readInt8(n,r),r++;2&T?(S.m.tx=b,S.m.ty=F):(S.p1=b,S.p2=F),8&T?(S.m.a=S.m.d=a.readF2dot14(n,r),r+=2):64&T?(S.m.a=a.readF2dot14(n,r),r+=2,S.m.d=a.readF2dot14(n,r),r+=2):128&T&&(S.m.a=a.readF2dot14(n,r),r+=2,S.m.b=a.readF2dot14(n,r),r+=2,S.m.c=a.readF2dot14(n,r),r+=2,S.m.d=a.readF2dot14(n,r),r+=2)}while(32&T);if(256&T){var k=a.readUshort(n,r);for(r+=2,i.instr=[],s=0;s<k;s++)i.instr.push(n[r]),r++}}return i},o.GPOS={},o.GPOS.parse=function(t,e,a,n){return o._lctf.parse(t,e,a,n,o.GPOS.subt)},o.GPOS.subt=function(t,e,a,n){var r=o._bin,i=a,s={};if(s.fmt=r.readUshort(t,a),a+=2,e==1||e==2||e==3||e==7||e==8&&s.fmt<=2){var l=r.readUshort(t,a);a+=2,s.coverage=o._lctf.readCoverage(t,l+i)}if(e==1&&s.fmt==1){var u=r.readUshort(t,a);a+=2;var f=o._lctf.numOfOnes(u);u!=0&&(s.pos=o.GPOS.readValueRecord(t,a,u))}else if(e==2&&s.fmt>=1&&s.fmt<=2){u=r.readUshort(t,a),a+=2;var g=r.readUshort(t,a);a+=2,f=o._lctf.numOfOnes(u);var p=o._lctf.numOfOnes(g);if(s.fmt==1){s.pairsets=[];var d=r.readUshort(t,a);a+=2;for(var x=0;x<d;x++){var h=i+r.readUshort(t,a);a+=2;var U=r.readUshort(t,h);h+=2;for(var T=[],S=0;S<U;S++){var b=r.readUshort(t,h);h+=2,u!=0&&(m=o.GPOS.readValueRecord(t,h,u),h+=2*f),g!=0&&(w=o.GPOS.readValueRecord(t,h,g),h+=2*p),T.push({gid2:b,val1:m,val2:w})}s.pairsets.push(T)}}if(s.fmt==2){var F=r.readUshort(t,a);a+=2;var k=r.readUshort(t,a);a+=2;var A=r.readUshort(t,a);a+=2;var O=r.readUshort(t,a);for(a+=2,s.classDef1=o._lctf.readClassDef(t,i+F),s.classDef2=o._lctf.readClassDef(t,i+k),s.matrix=[],x=0;x<A;x++){var B=[];for(S=0;S<O;S++){var m=null,w=null;u!=0&&(m=o.GPOS.readValueRecord(t,a,u),a+=2*f),g!=0&&(w=o.GPOS.readValueRecord(t,a,g),a+=2*p),B.push({val1:m,val2:w})}s.matrix.push(B)}}}else{if(e==9&&s.fmt==1){var C=r.readUshort(t,a);a+=2;var _=r.readUint(t,a);if(a+=4,n.ltype==9)n.ltype=C;else if(n.ltype!=C)throw"invalid extension substitution";return o.GPOS.subt(t,n.ltype,i+_)}console.debug("unsupported GPOS table LookupType",e,"format",s.fmt)}return s},o.GPOS.readValueRecord=function(t,e,a){var n=o._bin,r=[];return r.push(1&a?n.readShort(t,e):0),e+=1&a?2:0,r.push(2&a?n.readShort(t,e):0),e+=2&a?2:0,r.push(4&a?n.readShort(t,e):0),e+=4&a?2:0,r.push(8&a?n.readShort(t,e):0),e+=8&a?2:0,r},o.GSUB={},o.GSUB.parse=function(t,e,a,n){return o._lctf.parse(t,e,a,n,o.GSUB.subt)},o.GSUB.subt=function(t,e,a,n){var r=o._bin,i=a,s={};if(s.fmt=r.readUshort(t,a),a+=2,e!=1&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==4||e==5&&s.fmt<=2||e==6&&s.fmt<=2){var l=r.readUshort(t,a);a+=2,s.coverage=o._lctf.readCoverage(t,i+l)}if(e==1&&s.fmt>=1&&s.fmt<=2){if(s.fmt==1)s.delta=r.readShort(t,a),a+=2;else if(s.fmt==2){var u=r.readUshort(t,a);a+=2,s.newg=r.readUshorts(t,a,u),a+=2*s.newg.length}}else if(e==4){s.vals=[],u=r.readUshort(t,a),a+=2;for(var f=0;f<u;f++){var g=r.readUshort(t,a);a+=2,s.vals.push(o.GSUB.readLigatureSet(t,i+g))}}else if(e==5&&s.fmt==2){if(s.fmt==2){var p=r.readUshort(t,a);a+=2,s.cDef=o._lctf.readClassDef(t,i+p),s.scset=[];var d=r.readUshort(t,a);for(a+=2,f=0;f<d;f++){var x=r.readUshort(t,a);a+=2,s.scset.push(x==0?null:o.GSUB.readSubClassSet(t,i+x))}}}else if(e==6&&s.fmt==3){if(s.fmt==3){for(f=0;f<3;f++){u=r.readUshort(t,a),a+=2;for(var h=[],U=0;U<u;U++)h.push(o._lctf.readCoverage(t,i+r.readUshort(t,a+2*U)));a+=2*u,f==0&&(s.backCvg=h),f==1&&(s.inptCvg=h),f==2&&(s.ahedCvg=h)}u=r.readUshort(t,a),a+=2,s.lookupRec=o.GSUB.readSubstLookupRecords(t,a,u)}}else{if(e==7&&s.fmt==1){var T=r.readUshort(t,a);a+=2;var S=r.readUint(t,a);if(a+=4,n.ltype==9)n.ltype=T;else if(n.ltype!=T)throw"invalid extension substitution";return o.GSUB.subt(t,n.ltype,i+S)}console.debug("unsupported GSUB table LookupType",e,"format",s.fmt)}return s},o.GSUB.readSubClassSet=function(t,e){var a=o._bin.readUshort,n=e,r=[],i=a(t,e);e+=2;for(var s=0;s<i;s++){var l=a(t,e);e+=2,r.push(o.GSUB.readSubClassRule(t,n+l))}return r},o.GSUB.readSubClassRule=function(t,e){var a=o._bin.readUshort,n={},r=a(t,e),i=a(t,e+=2);e+=2,n.input=[];for(var s=0;s<r-1;s++)n.input.push(a(t,e)),e+=2;return n.substLookupRecords=o.GSUB.readSubstLookupRecords(t,e,i),n},o.GSUB.readSubstLookupRecords=function(t,e,a){for(var n=o._bin.readUshort,r=[],i=0;i<a;i++)r.push(n(t,e),n(t,e+2)),e+=4;return r},o.GSUB.readChainSubClassSet=function(t,e){var a=o._bin,n=e,r=[],i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var l=a.readUshort(t,e);e+=2,r.push(o.GSUB.readChainSubClassRule(t,n+l))}return r},o.GSUB.readChainSubClassRule=function(t,e){for(var a=o._bin,n={},r=["backtrack","input","lookahead"],i=0;i<r.length;i++){var s=a.readUshort(t,e);e+=2,i==1&&s--,n[r[i]]=a.readUshorts(t,e,s),e+=2*n[r[i]].length}return s=a.readUshort(t,e),e+=2,n.subst=a.readUshorts(t,e,2*s),e+=2*n.subst.length,n},o.GSUB.readLigatureSet=function(t,e){var a=o._bin,n=e,r=[],i=a.readUshort(t,e);e+=2;for(var s=0;s<i;s++){var l=a.readUshort(t,e);e+=2,r.push(o.GSUB.readLigature(t,n+l))}return r},o.GSUB.readLigature=function(t,e){var a=o._bin,n={chain:[]};n.nglyph=a.readUshort(t,e),e+=2;var r=a.readUshort(t,e);e+=2;for(var i=0;i<r-1;i++)n.chain.push(a.readUshort(t,e)),e+=2;return n},o.head={},o.head.parse=function(t,e,a){var n=o._bin,r={};return n.readFixed(t,e),e+=4,r.fontRevision=n.readFixed(t,e),e+=4,n.readUint(t,e),e+=4,n.readUint(t,e),e+=4,r.flags=n.readUshort(t,e),e+=2,r.unitsPerEm=n.readUshort(t,e),e+=2,r.created=n.readUint64(t,e),e+=8,r.modified=n.readUint64(t,e),e+=8,r.xMin=n.readShort(t,e),e+=2,r.yMin=n.readShort(t,e),e+=2,r.xMax=n.readShort(t,e),e+=2,r.yMax=n.readShort(t,e),e+=2,r.macStyle=n.readUshort(t,e),e+=2,r.lowestRecPPEM=n.readUshort(t,e),e+=2,r.fontDirectionHint=n.readShort(t,e),e+=2,r.indexToLocFormat=n.readShort(t,e),e+=2,r.glyphDataFormat=n.readShort(t,e),e+=2,r},o.hhea={},o.hhea.parse=function(t,e,a){var n=o._bin,r={};return n.readFixed(t,e),e+=4,r.ascender=n.readShort(t,e),e+=2,r.descender=n.readShort(t,e),e+=2,r.lineGap=n.readShort(t,e),e+=2,r.advanceWidthMax=n.readUshort(t,e),e+=2,r.minLeftSideBearing=n.readShort(t,e),e+=2,r.minRightSideBearing=n.readShort(t,e),e+=2,r.xMaxExtent=n.readShort(t,e),e+=2,r.caretSlopeRise=n.readShort(t,e),e+=2,r.caretSlopeRun=n.readShort(t,e),e+=2,r.caretOffset=n.readShort(t,e),e+=2,e+=8,r.metricDataFormat=n.readShort(t,e),e+=2,r.numberOfHMetrics=n.readUshort(t,e),e+=2,r},o.hmtx={},o.hmtx.parse=function(t,e,a,n){for(var r=o._bin,i={aWidth:[],lsBearing:[]},s=0,l=0,u=0;u<n.maxp.numGlyphs;u++)u<n.hhea.numberOfHMetrics&&(s=r.readUshort(t,e),e+=2,l=r.readShort(t,e),e+=2),i.aWidth.push(s),i.lsBearing.push(l);return i},o.kern={},o.kern.parse=function(t,e,a,n){var r=o._bin,i=r.readUshort(t,e);if(e+=2,i==1)return o.kern.parseV1(t,e-2,a,n);var s=r.readUshort(t,e);e+=2;for(var l={glyph1:[],rval:[]},u=0;u<s;u++){e+=2,a=r.readUshort(t,e),e+=2;var f=r.readUshort(t,e);e+=2;var g=f>>>8;if((g&=15)!=0)throw"unknown kern table format: "+g;e=o.kern.readFormat0(t,e,l)}return l},o.kern.parseV1=function(t,e,a,n){var r=o._bin;r.readFixed(t,e),e+=4;var i=r.readUint(t,e);e+=4;for(var s={glyph1:[],rval:[]},l=0;l<i;l++){r.readUint(t,e),e+=4;var u=r.readUshort(t,e);e+=2,r.readUshort(t,e),e+=2;var f=u>>>8;if((f&=15)!=0)throw"unknown kern table format: "+f;e=o.kern.readFormat0(t,e,s)}return s},o.kern.readFormat0=function(t,e,a){var n=o._bin,r=-1,i=n.readUshort(t,e);e+=2,n.readUshort(t,e),e+=2,n.readUshort(t,e),e+=2,n.readUshort(t,e),e+=2;for(var s=0;s<i;s++){var l=n.readUshort(t,e);e+=2;var u=n.readUshort(t,e);e+=2;var f=n.readShort(t,e);e+=2,l!=r&&(a.glyph1.push(l),a.rval.push({glyph2:[],vals:[]}));var g=a.rval[a.rval.length-1];g.glyph2.push(u),g.vals.push(f),r=l}return e},o.loca={},o.loca.parse=function(t,e,a,n){var r=o._bin,i=[],s=n.head.indexToLocFormat,l=n.maxp.numGlyphs+1;if(s==0)for(var u=0;u<l;u++)i.push(r.readUshort(t,e+(u<<1))<<1);if(s==1)for(u=0;u<l;u++)i.push(r.readUint(t,e+(u<<2)));return i},o.maxp={},o.maxp.parse=function(t,e,a){var n=o._bin,r={},i=n.readUint(t,e);return e+=4,r.numGlyphs=n.readUshort(t,e),e+=2,i==65536&&(r.maxPoints=n.readUshort(t,e),e+=2,r.maxContours=n.readUshort(t,e),e+=2,r.maxCompositePoints=n.readUshort(t,e),e+=2,r.maxCompositeContours=n.readUshort(t,e),e+=2,r.maxZones=n.readUshort(t,e),e+=2,r.maxTwilightPoints=n.readUshort(t,e),e+=2,r.maxStorage=n.readUshort(t,e),e+=2,r.maxFunctionDefs=n.readUshort(t,e),e+=2,r.maxInstructionDefs=n.readUshort(t,e),e+=2,r.maxStackElements=n.readUshort(t,e),e+=2,r.maxSizeOfInstructions=n.readUshort(t,e),e+=2,r.maxComponentElements=n.readUshort(t,e),e+=2,r.maxComponentDepth=n.readUshort(t,e),e+=2),r},o.name={},o.name.parse=function(t,e,a){var n=o._bin,r={};n.readUshort(t,e),e+=2;var i=n.readUshort(t,e);e+=2,n.readUshort(t,e);for(var s,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],u=e+=2,f=0;f<i;f++){var g=n.readUshort(t,e);e+=2;var p=n.readUshort(t,e);e+=2;var d=n.readUshort(t,e);e+=2;var x=n.readUshort(t,e);e+=2;var h=n.readUshort(t,e);e+=2;var U=n.readUshort(t,e);e+=2;var T,S=l[x],b=u+12*i+U;if(g==0)T=n.readUnicode(t,b,h/2);else if(g==3&&p==0)T=n.readUnicode(t,b,h/2);else if(p==0)T=n.readASCII(t,b,h);else if(p==1)T=n.readUnicode(t,b,h/2);else if(p==3)T=n.readUnicode(t,b,h/2);else{if(g!=1)throw"unknown encoding "+p+", platformID: "+g;T=n.readASCII(t,b,h),console.debug("reading unknown MAC encoding "+p+" as ASCII")}var F="p"+g+","+d.toString(16);r[F]==null&&(r[F]={}),r[F][S!==void 0?S:x]=T,r[F]._lang=d}for(var k in r)if(r[k].postScriptName!=null&&r[k]._lang==1033)return r[k];for(var k in r)if(r[k].postScriptName!=null&&r[k]._lang==0)return r[k];for(var k in r)if(r[k].postScriptName!=null&&r[k]._lang==3084)return r[k];for(var k in r)if(r[k].postScriptName!=null)return r[k];for(var k in r){s=k;break}return console.debug("returning name table with languageID "+r[s]._lang),r[s]},o["OS/2"]={},o["OS/2"].parse=function(t,e,a){var n=o._bin.readUshort(t,e);e+=2;var r={};if(n==0)o["OS/2"].version0(t,e,r);else if(n==1)o["OS/2"].version1(t,e,r);else if(n==2||n==3||n==4)o["OS/2"].version2(t,e,r);else{if(n!=5)throw"unknown OS/2 table version: "+n;o["OS/2"].version5(t,e,r)}return r},o["OS/2"].version0=function(t,e,a){var n=o._bin;return a.xAvgCharWidth=n.readShort(t,e),e+=2,a.usWeightClass=n.readUshort(t,e),e+=2,a.usWidthClass=n.readUshort(t,e),e+=2,a.fsType=n.readUshort(t,e),e+=2,a.ySubscriptXSize=n.readShort(t,e),e+=2,a.ySubscriptYSize=n.readShort(t,e),e+=2,a.ySubscriptXOffset=n.readShort(t,e),e+=2,a.ySubscriptYOffset=n.readShort(t,e),e+=2,a.ySuperscriptXSize=n.readShort(t,e),e+=2,a.ySuperscriptYSize=n.readShort(t,e),e+=2,a.ySuperscriptXOffset=n.readShort(t,e),e+=2,a.ySuperscriptYOffset=n.readShort(t,e),e+=2,a.yStrikeoutSize=n.readShort(t,e),e+=2,a.yStrikeoutPosition=n.readShort(t,e),e+=2,a.sFamilyClass=n.readShort(t,e),e+=2,a.panose=n.readBytes(t,e,10),e+=10,a.ulUnicodeRange1=n.readUint(t,e),e+=4,a.ulUnicodeRange2=n.readUint(t,e),e+=4,a.ulUnicodeRange3=n.readUint(t,e),e+=4,a.ulUnicodeRange4=n.readUint(t,e),e+=4,a.achVendID=[n.readInt8(t,e),n.readInt8(t,e+1),n.readInt8(t,e+2),n.readInt8(t,e+3)],e+=4,a.fsSelection=n.readUshort(t,e),e+=2,a.usFirstCharIndex=n.readUshort(t,e),e+=2,a.usLastCharIndex=n.readUshort(t,e),e+=2,a.sTypoAscender=n.readShort(t,e),e+=2,a.sTypoDescender=n.readShort(t,e),e+=2,a.sTypoLineGap=n.readShort(t,e),e+=2,a.usWinAscent=n.readUshort(t,e),e+=2,a.usWinDescent=n.readUshort(t,e),e+=2},o["OS/2"].version1=function(t,e,a){var n=o._bin;return e=o["OS/2"].version0(t,e,a),a.ulCodePageRange1=n.readUint(t,e),e+=4,a.ulCodePageRange2=n.readUint(t,e),e+=4},o["OS/2"].version2=function(t,e,a){var n=o._bin;return e=o["OS/2"].version1(t,e,a),a.sxHeight=n.readShort(t,e),e+=2,a.sCapHeight=n.readShort(t,e),e+=2,a.usDefault=n.readUshort(t,e),e+=2,a.usBreak=n.readUshort(t,e),e+=2,a.usMaxContext=n.readUshort(t,e),e+=2},o["OS/2"].version5=function(t,e,a){var n=o._bin;return e=o["OS/2"].version2(t,e,a),a.usLowerOpticalPointSize=n.readUshort(t,e),e+=2,a.usUpperOpticalPointSize=n.readUshort(t,e),e+=2},o.post={},o.post.parse=function(t,e,a){var n=o._bin,r={};return r.version=n.readFixed(t,e),e+=4,r.italicAngle=n.readFixed(t,e),e+=4,r.underlinePosition=n.readShort(t,e),e+=2,r.underlineThickness=n.readShort(t,e),e+=2,r},o==null&&(o={}),o.U==null&&(o.U={}),o.U.codeToGlyph=function(t,e){var a=t.cmap,n=-1;if(a.p0e4!=null?n=a.p0e4:a.p3e1!=null?n=a.p3e1:a.p1e0!=null?n=a.p1e0:a.p0e3!=null&&(n=a.p0e3),n==-1)throw"no familiar platform and encoding!";var r=a.tables[n];if(r.format==0)return e>=r.map.length?0:r.map[e];if(r.format==4){for(var i=-1,s=0;s<r.endCount.length;s++)if(e<=r.endCount[s]){i=s;break}return i==-1||r.startCount[i]>e?0:65535&(r.idRangeOffset[i]!=0?r.glyphIdArray[e-r.startCount[i]+(r.idRangeOffset[i]>>1)-(r.idRangeOffset.length-i)]:e+r.idDelta[i])}if(r.format==12){if(e>r.groups[r.groups.length-1][1])return 0;for(s=0;s<r.groups.length;s++){var l=r.groups[s];if(l[0]<=e&&e<=l[1])return l[2]+(e-l[0])}return 0}throw"unknown cmap table format "+r.format},o.U.glyphToPath=function(t,e){var a={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[e]){var n=t.SVG.entries[e];return n==null?a:(typeof n=="string"&&(n=o.SVG.toPath(n),t.SVG.entries[e]=n),n)}if(t.CFF){var r={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},i=t.CFF,s=t.CFF.Private;if(i.ROS){for(var l=0;i.FDSelect[l+2]<=e;)l+=2;s=i.FDArray[i.FDSelect[l+1]].Private}o.U._drawCFF(t.CFF.CharStrings[e],r,i,s,a)}else t.glyf&&o.U._drawGlyf(e,t,a);return a},o.U._drawGlyf=function(t,e,a){var n=e.glyf[t];n==null&&(n=e.glyf[t]=o.glyf._parseGlyf(e,t)),n!=null&&(n.noc>-1?o.U._simpleGlyph(n,a):o.U._compoGlyph(n,e,a))},o.U._simpleGlyph=function(t,e){for(var a=0;a<t.noc;a++){for(var n=a==0?0:t.endPts[a-1]+1,r=t.endPts[a],i=n;i<=r;i++){var s=i==n?r:i-1,l=i==r?n:i+1,u=1&t.flags[i],f=1&t.flags[s],g=1&t.flags[l],p=t.xs[i],d=t.ys[i];if(i==n)if(u){if(!f){o.U.P.moveTo(e,p,d);continue}o.U.P.moveTo(e,t.xs[s],t.ys[s])}else f?o.U.P.moveTo(e,t.xs[s],t.ys[s]):o.U.P.moveTo(e,(t.xs[s]+p)/2,(t.ys[s]+d)/2);u?f&&o.U.P.lineTo(e,p,d):g?o.U.P.qcurveTo(e,p,d,t.xs[l],t.ys[l]):o.U.P.qcurveTo(e,p,d,(p+t.xs[l])/2,(d+t.ys[l])/2)}o.U.P.closePath(e)}},o.U._compoGlyph=function(t,e,a){for(var n=0;n<t.parts.length;n++){var r={cmds:[],crds:[]},i=t.parts[n];o.U._drawGlyf(i.glyphIndex,e,r);for(var s=i.m,l=0;l<r.crds.length;l+=2){var u=r.crds[l],f=r.crds[l+1];a.crds.push(u*s.a+f*s.b+s.tx),a.crds.push(u*s.c+f*s.d+s.ty)}for(l=0;l<r.cmds.length;l++)a.cmds.push(r.cmds[l])}},o.U._getGlyphClass=function(t,e){var a=o._lctf.getInterval(e,t);return a==-1?0:e[a+2]},o.U.getPairAdjustment=function(t,e,a){var n=!1;if(t.GPOS)for(var r=t.GPOS,i=r.lookupList,s=r.featureList,l=[],u=0;u<s.length;u++){var f=s[u];if(f.tag=="kern"){n=!0;for(var g=0;g<f.tab.length;g++)if(!l[f.tab[g]]){l[f.tab[g]]=!0;for(var p=i[f.tab[g]],d=0;d<p.tabs.length;d++)if(p.tabs[d]!=null){var x,h=p.tabs[d];if((!h.coverage||(x=o._lctf.coverageIndex(h.coverage,e))!=-1)&&p.ltype!=1){if(p.ltype==2){var U=null;if(h.fmt==1){var T=h.pairsets[x];for(u=0;u<T.length;u++)T[u].gid2==a&&(U=T[u])}else if(h.fmt==2){var S=o.U._getGlyphClass(e,h.classDef1),b=o.U._getGlyphClass(a,h.classDef2);U=h.matrix[S][b]}if(U){var F=0;return U.val1&&U.val1[2]&&(F+=U.val1[2]),U.val2&&U.val2[0]&&(F+=U.val2[0]),F}}}}}}}if(t.kern&&!n){var k=t.kern.glyph1.indexOf(e);if(k!=-1){var A=t.kern.rval[k].glyph2.indexOf(a);if(A!=-1)return t.kern.rval[k].vals[A]}}return 0},o.U._applySubs=function(t,e,a,n){for(var r=t.length-e-1,i=0;i<a.tabs.length;i++)if(a.tabs[i]!=null){var s,l=a.tabs[i];if(!l.coverage||(s=o._lctf.coverageIndex(l.coverage,t[e]))!=-1){if(a.ltype==1)t[e],l.fmt==1?t[e]=t[e]+l.delta:t[e]=l.newg[s];else if(a.ltype==4)for(var u=l.vals[s],f=0;f<u.length;f++){var g=u[f],p=g.chain.length;if(!(p>r)){for(var d=!0,x=0,h=0;h<p;h++){for(;t[e+x+(1+h)]==-1;)x++;g.chain[h]!=t[e+x+(1+h)]&&(d=!1)}if(d){for(t[e]=g.nglyph,h=0;h<p+x;h++)t[e+h+1]=-1;break}}}else if(a.ltype==5&&l.fmt==2)for(var U=o._lctf.getInterval(l.cDef,t[e]),T=l.cDef[U+2],S=l.scset[T],b=0;b<S.length;b++){var F=S[b],k=F.input;if(!(k.length>r)){for(d=!0,h=0;h<k.length;h++){var A=o._lctf.getInterval(l.cDef,t[e+1+h]);if(U==-1&&l.cDef[A+2]!=k[h]){d=!1;break}}if(d){var O=F.substLookupRecords;for(f=0;f<O.length;f+=2)O[f],O[f+1]}}}else if(a.ltype==6&&l.fmt==3){if(!o.U._glsCovered(t,l.backCvg,e-l.backCvg.length)||!o.U._glsCovered(t,l.inptCvg,e)||!o.U._glsCovered(t,l.ahedCvg,e+l.inptCvg.length))continue;var B=l.lookupRec;for(b=0;b<B.length;b+=2){U=B[b];var m=n[B[b+1]];o.U._applySubs(t,e+U,m,n)}}}}},o.U._glsCovered=function(t,e,a){for(var n=0;n<e.length;n++)if(o._lctf.coverageIndex(e[n],t[a+n])==-1)return!1;return!0},o.U.glyphsToPath=function(t,e,a){for(var n={cmds:[],crds:[]},r=0,i=0;i<e.length;i++){var s=e[i];if(s!=-1){for(var l=i<e.length-1&&e[i+1]!=-1?e[i+1]:0,u=o.U.glyphToPath(t,s),f=0;f<u.crds.length;f+=2)n.crds.push(u.crds[f]+r),n.crds.push(u.crds[f+1]);for(a&&n.cmds.push(a),f=0;f<u.cmds.length;f++)n.cmds.push(u.cmds[f]);a&&n.cmds.push("X"),r+=t.hmtx.aWidth[s],i<e.length-1&&(r+=o.U.getPairAdjustment(t,s,l))}}return n},o.U.P={},o.U.P.moveTo=function(t,e,a){t.cmds.push("M"),t.crds.push(e,a)},o.U.P.lineTo=function(t,e,a){t.cmds.push("L"),t.crds.push(e,a)},o.U.P.curveTo=function(t,e,a,n,r,i,s){t.cmds.push("C"),t.crds.push(e,a,n,r,i,s)},o.U.P.qcurveTo=function(t,e,a,n,r){t.cmds.push("Q"),t.crds.push(e,a,n,r)},o.U.P.closePath=function(t){t.cmds.push("Z")},o.U._drawCFF=function(t,e,a,n,r){for(var i=e.stack,s=e.nStems,l=e.haveWidth,u=e.width,f=e.open,g=0,p=e.x,d=e.y,x=0,h=0,U=0,T=0,S=0,b=0,F=0,k=0,A=0,O=0,B={val:0,size:0};g<t.length;){o.CFF.getCharString(t,g,B);var m=B.val;if(g+=B.size,m=="o1"||m=="o18")i.length%2!=0&&!l&&(u=i.shift()+n.nominalWidthX),s+=i.length>>1,i.length=0,l=!0;else if(m=="o3"||m=="o23")i.length%2!=0&&!l&&(u=i.shift()+n.nominalWidthX),s+=i.length>>1,i.length=0,l=!0;else if(m=="o4")i.length>1&&!l&&(u=i.shift()+n.nominalWidthX,l=!0),f&&o.U.P.closePath(r),d+=i.pop(),o.U.P.moveTo(r,p,d),f=!0;else if(m=="o5")for(;i.length>0;)p+=i.shift(),d+=i.shift(),o.U.P.lineTo(r,p,d);else if(m=="o6"||m=="o7")for(var w=i.length,C=m=="o6",_=0;_<w;_++){var D=i.shift();C?p+=D:d+=D,C=!C,o.U.P.lineTo(r,p,d)}else if(m=="o8"||m=="o24"){w=i.length;for(var P=0;P+6<=w;)x=p+i.shift(),h=d+i.shift(),U=x+i.shift(),T=h+i.shift(),p=U+i.shift(),d=T+i.shift(),o.U.P.curveTo(r,x,h,U,T,p,d),P+=6;m=="o24"&&(p+=i.shift(),d+=i.shift(),o.U.P.lineTo(r,p,d))}else{if(m=="o11")break;if(m=="o1234"||m=="o1235"||m=="o1236"||m=="o1237")m=="o1234"&&(h=d,U=(x=p+i.shift())+i.shift(),O=T=h+i.shift(),b=T,k=d,p=(F=(S=(A=U+i.shift())+i.shift())+i.shift())+i.shift(),o.U.P.curveTo(r,x,h,U,T,A,O),o.U.P.curveTo(r,S,b,F,k,p,d)),m=="o1235"&&(x=p+i.shift(),h=d+i.shift(),U=x+i.shift(),T=h+i.shift(),A=U+i.shift(),O=T+i.shift(),S=A+i.shift(),b=O+i.shift(),F=S+i.shift(),k=b+i.shift(),p=F+i.shift(),d=k+i.shift(),i.shift(),o.U.P.curveTo(r,x,h,U,T,A,O),o.U.P.curveTo(r,S,b,F,k,p,d)),m=="o1236"&&(x=p+i.shift(),h=d+i.shift(),U=x+i.shift(),O=T=h+i.shift(),b=T,F=(S=(A=U+i.shift())+i.shift())+i.shift(),k=b+i.shift(),p=F+i.shift(),o.U.P.curveTo(r,x,h,U,T,A,O),o.U.P.curveTo(r,S,b,F,k,p,d)),m=="o1237"&&(x=p+i.shift(),h=d+i.shift(),U=x+i.shift(),T=h+i.shift(),A=U+i.shift(),O=T+i.shift(),S=A+i.shift(),b=O+i.shift(),F=S+i.shift(),k=b+i.shift(),Math.abs(F-p)>Math.abs(k-d)?p=F+i.shift():d=k+i.shift(),o.U.P.curveTo(r,x,h,U,T,A,O),o.U.P.curveTo(r,S,b,F,k,p,d));else if(m=="o14"){if(i.length>0&&!l&&(u=i.shift()+a.nominalWidthX,l=!0),i.length==4){var R=i.shift(),W=i.shift(),Y=i.shift(),G=i.shift(),E=o.CFF.glyphBySE(a,Y),M=o.CFF.glyphBySE(a,G);o.U._drawCFF(a.CharStrings[E],e,a,n,r),e.x=R,e.y=W,o.U._drawCFF(a.CharStrings[M],e,a,n,r)}f&&(o.U.P.closePath(r),f=!1)}else if(m=="o19"||m=="o20")i.length%2!=0&&!l&&(u=i.shift()+n.nominalWidthX),s+=i.length>>1,i.length=0,l=!0,g+=s+7>>3;else if(m=="o21")i.length>2&&!l&&(u=i.shift()+n.nominalWidthX,l=!0),d+=i.pop(),p+=i.pop(),f&&o.U.P.closePath(r),o.U.P.moveTo(r,p,d),f=!0;else if(m=="o22")i.length>1&&!l&&(u=i.shift()+n.nominalWidthX,l=!0),p+=i.pop(),f&&o.U.P.closePath(r),o.U.P.moveTo(r,p,d),f=!0;else if(m=="o25"){for(;i.length>6;)p+=i.shift(),d+=i.shift(),o.U.P.lineTo(r,p,d);x=p+i.shift(),h=d+i.shift(),U=x+i.shift(),T=h+i.shift(),p=U+i.shift(),d=T+i.shift(),o.U.P.curveTo(r,x,h,U,T,p,d)}else if(m=="o26")for(i.length%2&&(p+=i.shift());i.length>0;)x=p,h=d+i.shift(),p=U=x+i.shift(),d=(T=h+i.shift())+i.shift(),o.U.P.curveTo(r,x,h,U,T,p,d);else if(m=="o27")for(i.length%2&&(d+=i.shift());i.length>0;)h=d,U=(x=p+i.shift())+i.shift(),T=h+i.shift(),p=U+i.shift(),d=T,o.U.P.curveTo(r,x,h,U,T,p,d);else if(m=="o10"||m=="o29"){var X=m=="o10"?n:a;if(i.length==0)console.debug("error: empty stack");else{var Q=i.pop(),K=X.Subrs[Q+X.Bias];e.x=p,e.y=d,e.nStems=s,e.haveWidth=l,e.width=u,e.open=f,o.U._drawCFF(K,e,a,n,r),p=e.x,d=e.y,s=e.nStems,l=e.haveWidth,u=e.width,f=e.open}}else if(m=="o30"||m=="o31"){var oe=i.length,H=(P=0,m=="o31");for(P+=oe-(w=-3&oe);P<w;)H?(h=d,U=(x=p+i.shift())+i.shift(),d=(T=h+i.shift())+i.shift(),w-P==5?(p=U+i.shift(),P++):p=U,H=!1):(x=p,h=d+i.shift(),U=x+i.shift(),T=h+i.shift(),p=U+i.shift(),w-P==5?(d=T+i.shift(),P++):d=T,H=!0),o.U.P.curveTo(r,x,h,U,T,p,d),P+=4}else{if((m+"").charAt(0)=="o")throw console.debug("Unknown operation: "+m,t),m;i.push(m)}}}e.x=p,e.y=d,e.nStems=s,e.haveWidth=l,e.width=u,e.open=f};var v=o,c={Typr:v};return y.Typr=v,y.default=c,Object.defineProperty(y,"__esModule",{value:!0}),y}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function tr(){return function(y){var o=Uint8Array,v=Uint16Array,c=Uint32Array,t=new o([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new o([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new o([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),n=function(m,w){for(var C=new v(31),_=0;_<31;++_)C[_]=w+=1<<m[_-1];var D=new c(C[30]);for(_=1;_<30;++_)for(var P=C[_];P<C[_+1];++P)D[P]=P-C[_]<<5|_;return[C,D]},r=n(t,2),i=r[0],s=r[1];i[28]=258,s[258]=28;for(var l=n(e,0)[0],u=new v(32768),f=0;f<32768;++f){var g=(43690&f)>>>1|(21845&f)<<1;g=(61680&(g=(52428&g)>>>2|(13107&g)<<2))>>>4|(3855&g)<<4,u[f]=((65280&g)>>>8|(255&g)<<8)>>>1}var p=function(m,w,C){for(var _=m.length,D=0,P=new v(w);D<_;++D)++P[m[D]-1];var R,W=new v(w);for(D=0;D<w;++D)W[D]=W[D-1]+P[D-1]<<1;if(C){R=new v(1<<w);var Y=15-w;for(D=0;D<_;++D)if(m[D])for(var G=D<<4|m[D],E=w-m[D],M=W[m[D]-1]++<<E,X=M|(1<<E)-1;M<=X;++M)R[u[M]>>>Y]=G}else for(R=new v(_),D=0;D<_;++D)m[D]&&(R[D]=u[W[m[D]-1]++]>>>15-m[D]);return R},d=new o(288);for(f=0;f<144;++f)d[f]=8;for(f=144;f<256;++f)d[f]=9;for(f=256;f<280;++f)d[f]=7;for(f=280;f<288;++f)d[f]=8;var x=new o(32);for(f=0;f<32;++f)x[f]=5;var h=p(d,9,1),U=p(x,5,1),T=function(m){for(var w=m[0],C=1;C<m.length;++C)m[C]>w&&(w=m[C]);return w},S=function(m,w,C){var _=w/8|0;return(m[_]|m[_+1]<<8)>>(7&w)&C},b=function(m,w){var C=w/8|0;return(m[C]|m[C+1]<<8|m[C+2]<<16)>>(7&w)},F=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],k=function(m,w,C){var _=new Error(w||F[m]);if(_.code=m,Error.captureStackTrace&&Error.captureStackTrace(_,k),!C)throw _;return _},A=function(m,w,C){var _=m.length;if(!_||C&&!C.l&&_<5)return w||new o(0);var D=!w||C,P=!C||C.i;C||(C={}),w||(w=new o(3*_));var R,W=function(j){var ee=w.length;if(j>ee){var ie=new o(Math.max(2*ee,j));ie.set(w),w=ie}},Y=C.f||0,G=C.p||0,E=C.b||0,M=C.l,X=C.d,Q=C.m,K=C.n,oe=8*_;do{if(!M){C.f=Y=S(m,G,1);var H=S(m,G+1,3);if(G+=3,!H){var $=m[(ve=((R=G)/8|0)+(7&R&&1)+4)-4]|m[ve-3]<<8,V=ve+$;if(V>_){P&&k(0);break}D&&W(E+$),w.set(m.subarray(ve,V),E),C.b=E+=$,C.p=G=8*V;continue}if(H==1)M=h,X=U,Q=9,K=5;else if(H==2){var I=S(m,G,31)+257,z=S(m,G+10,15)+4,fe=I+S(m,G+5,31)+1;G+=14;for(var re=new o(fe),N=new o(19),ne=0;ne<z;++ne)N[a[ne]]=S(m,G+3*ne,7);G+=3*z;var Oe=T(N),Ye=(1<<Oe)-1,Ee=p(N,Oe,1);for(ne=0;ne<fe;){var ve,Le=Ee[S(m,G,Ye)];if(G+=15&Le,(ve=Le>>>4)<16)re[ne++]=ve;else{var q=0,De=0;for(ve==16?(De=3+S(m,G,3),G+=2,q=re[ne-1]):ve==17?(De=3+S(m,G,7),G+=3):ve==18&&(De=11+S(m,G,127),G+=7);De--;)re[ne++]=q}}var ke=re.subarray(0,I),Se=re.subarray(I);Q=T(ke),K=T(Se),M=p(ke,Q,1),X=p(Se,K,1)}else k(1);if(G>oe){P&&k(0);break}}D&&W(E+131072);for(var $e=(1<<Q)-1,Fe=(1<<K)-1,se=G;;se=G){var de=(q=M[b(m,G)&$e])>>>4;if((G+=15&q)>oe){P&&k(0);break}if(q||k(2),de<256)w[E++]=de;else{if(de==256){se=G,M=null;break}var Ue=de-254;if(de>264){var ge=t[ne=de-257];Ue=S(m,G,(1<<ge)-1)+i[ne],G+=ge}var L=X[b(m,G)&Fe],le=L>>>4;if(L||k(3),G+=15&L,Se=l[le],le>3&&(ge=e[le],Se+=b(m,G)&(1<<ge)-1,G+=ge),G>oe){P&&k(0);break}D&&W(E+131072);for(var be=E+Ue;E<be;E+=4)w[E]=w[E-Se],w[E+1]=w[E+1-Se],w[E+2]=w[E+2-Se],w[E+3]=w[E+3-Se];E=be}}C.l=M,C.p=se,C.b=E,M&&(Y=1,C.m=Q,C.d=X,C.n=K)}while(!Y);return E==w.length?w:function(j,ee,ie){(ee==null||ee<0)&&(ee=0),(ie==null||ie>j.length)&&(ie=j.length);var ue=new(j instanceof v?v:j instanceof c?c:o)(ie-ee);return ue.set(j.subarray(ee,ie)),ue}(w,0,E)},O=new o(0),B=typeof TextDecoder<"u"&&new TextDecoder;try{B.decode(O,{stream:!0})}catch{}return y.convert_streams=function(m){var w=new DataView(m),C=0;function _(){var I=w.getUint16(C);return C+=2,I}function D(){var I=w.getUint32(C);return C+=4,I}function P(I){$.setUint16(V,I),V+=2}function R(I){$.setUint32(V,I),V+=4}for(var W={signature:D(),flavor:D(),length:D(),numTables:_(),reserved:_(),totalSfntSize:D(),majorVersion:_(),minorVersion:_(),metaOffset:D(),metaLength:D(),metaOrigLength:D(),privOffset:D(),privLength:D()},Y=0;Math.pow(2,Y)<=W.numTables;)Y++;Y--;for(var G=16*Math.pow(2,Y),E=16*W.numTables-G,M=12,X=[],Q=0;Q<W.numTables;Q++)X.push({tag:D(),offset:D(),compLength:D(),origLength:D(),origChecksum:D()}),M+=16;var K,oe=new Uint8Array(12+16*X.length+X.reduce(function(I,z){return I+z.origLength+4},0)),H=oe.buffer,$=new DataView(H),V=0;return R(W.flavor),P(W.numTables),P(G),P(Y),P(E),X.forEach(function(I){R(I.tag),R(I.origChecksum),R(M),R(I.origLength),I.outOffset=M,(M+=I.origLength)%4!=0&&(M+=4-M%4)}),X.forEach(function(I){var z,fe=m.slice(I.offset,I.offset+I.compLength);if(I.compLength!=I.origLength){var re=new Uint8Array(I.origLength);z=new Uint8Array(fe,2),A(z,re)}else re=new Uint8Array(fe);oe.set(re,I.outOffset);var N=0;(M=I.outOffset+I.origLength)%4!=0&&(N=4-M%4),oe.set(new Uint8Array(N).buffer,I.outOffset+I.origLength),K=M+N}),H.slice(0,K)},Object.defineProperty(y,"__esModule",{value:!0}),y}({}).convert_streams}function rr(y,o){const v={M:2,L:2,Q:4,C:6,Z:0},c={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},t=1,e=2,a=4,n=8,r=16,i=32;let s;function l(S){if(!s){const b={R:e,L:t,D:a,C:r,U:i,T:n};s=new Map;for(let F in c){let k=0;c[F].split(",").forEach(A=>{let[O,B]=A.split("+");O=parseInt(O,36),B=B?parseInt(B,36):0,s.set(k+=O,b[F]);for(let m=B;m--;)s.set(++k,b[F])})}}return s.get(S)||i}const u=1,f=2,g=3,p=4,d=[null,"isol","init","fina","medi"];function x(S){const b=new Uint8Array(S.length);let F=i,k=u,A=-1;for(let O=0;O<S.length;O++){const B=S.codePointAt(O);let m=l(B)|0,w=u;m&n||(F&(t|a|r)?m&(e|a|r)?(w=g,(k===u||k===g)&&b[A]++):m&(t|i)&&(k===f||k===p)&&b[A]--:F&(e|i)&&(k===f||k===p)&&b[A]--,k=b[O]=w,F=m,A=O,B>65535&&O++)}return b}function h(S,b){const F=[];for(let A=0;A<b.length;A++){const O=b.codePointAt(A);O>65535&&A++,F.push(y.U.codeToGlyph(S,O))}const k=S.GSUB;if(k){const{lookupList:A,featureList:O}=k;let B;const m=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,w=[];O.forEach(C=>{if(m.test(C.tag))for(let _=0;_<C.tab.length;_++){if(w[C.tab[_]])continue;w[C.tab[_]]=!0;const D=A[C.tab[_]],P=/^(isol|init|fina|medi)$/.test(C.tag);P&&!B&&(B=x(b));for(let R=0;R<F.length;R++)(!B||!P||d[B[R]]===C.tag)&&y.U._applySubs(F,R,D,A)}})}return F}function U(...S){for(let b=0;b<S.length;b++)if(typeof S[b]=="number")return S[b]}function T(S){const b=Object.create(null),F=S["OS/2"],k=S.hhea,A=S.head.unitsPerEm,O=U(F&&F.sTypoAscender,k&&k.ascender,A),B={unitsPerEm:A,ascender:O,descender:U(F&&F.sTypoDescender,k&&k.descender,0),capHeight:U(F&&F.sCapHeight,O),xHeight:U(F&&F.sxHeight,O),lineGap:U(F&&F.sTypoLineGap,k&&k.lineGap),forEachGlyph(m,w,C,_){let D=0;const P=1/B.unitsPerEm*w,R=h(S,m);let W=0,Y=-1;return R.forEach((G,E)=>{if(G!==-1){let M=b[G];if(!M){const{cmds:X,crds:Q}=y.U.glyphToPath(S,G);let K="",oe=0;for(let z=0,fe=X.length;z<fe;z++){const re=v[X[z]];K+=X[z];for(let N=1;N<=re;N++)K+=(N>1?",":"")+Q[oe++]}let H,$,V,I;if(Q.length){H=$=1/0,V=I=-1/0;for(let z=0,fe=Q.length;z<fe;z+=2){let re=Q[z],N=Q[z+1];re<H&&(H=re),N<$&&($=N),re>V&&(V=re),N>I&&(I=N)}}else H=V=$=I=0;M=b[G]={index:G,advanceWidth:S.hmtx.aWidth[G],xMin:H,yMin:$,xMax:V,yMax:I,path:K,pathCommandCount:X.length}}Y!==-1&&(D+=y.U.getPairAdjustment(S,Y,G)*P),_.call(null,M,D,W),M.advanceWidth&&(D+=M.advanceWidth*P),C&&(D+=C*w),Y=G}W+=m.codePointAt(W)>65535?2:1}),D}};return B}return function(b){const F=new Uint8Array(b,0,4),k=y._bin.readASCII(F,0,4);if(k==="wOFF")b=o(b);else if(k==="wOF2")throw new Error("woff2 fonts not supported");return T(y.parse(b)[0])}}const nr=qe({name:"Typr Font Parser",dependencies:[er,tr,rr],init(y,o,v){const c=y(),t=o();return v(c,t)}}),Be={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},ar=new nt;function Ie(){return(self.performance||Date).now()}const ct=Object.create(null);function Tt(y,o){y=ir({},y);const v=Ie();if(y.font=sr(y.font||Be.defaultFontURL),y.text=""+y.text,y.sdfGlyphSize=y.sdfGlyphSize||Be.sdfGlyphSize,y.colorRanges!=null){let l={};for(let u in y.colorRanges)if(y.colorRanges.hasOwnProperty(u)){let f=y.colorRanges[u];typeof f!="number"&&(f=ar.set(f).getHex()),l[u]=f}y.colorRanges=l}Object.freeze(y);const{textureWidth:c,sdfExponent:t}=Be,{sdfGlyphSize:e}=y,a=c/e*4;let n=ct[e];if(!n){const l=document.createElement("canvas");l.width=c,l.height=e*256/a,n=ct[e]={glyphCount:0,sdfGlyphSize:e,sdfCanvas:l,sdfTexture:new Gt(l,void 0,void 0,void 0,lt,lt),contextLost:!1,glyphsByFont:new Map},n.sdfTexture.generateMipmaps=!1,or(n)}const{sdfTexture:r,sdfCanvas:i}=n;let s=n.glyphsByFont.get(y.font);s||n.glyphsByFont.set(y.font,s=new Map),ur(y).then(l=>{const{glyphIds:u,glyphPositions:f,fontSize:g,unitsPerEm:p,timings:d}=l,x=[],h=new Float32Array(u.length*4),U=g/p;let T=0,S=0;const b=Ie();u.forEach((B,m)=>{let w=s.get(B);if(!w){const{path:P,pathBounds:R}=l.glyphData[B],W=Math.max(R[2]-R[0],R[3]-R[1])/e*(Be.sdfMargin*e+.5),Y=n.glyphCount++,G=[R[0]-W,R[1]-W,R[2]+W,R[3]+W];s.set(B,w={path:P,atlasIndex:Y,sdfViewBox:G}),x.push(w)}const{sdfViewBox:C}=w,_=f[S++],D=f[S++];h[T++]=_+C[0]*U,h[T++]=D+C[1]*U,h[T++]=_+C[2]*U,h[T++]=D+C[3]*U,u[m]=w.atlasIndex}),d.quads=(d.quads||0)+(Ie()-b);const F=Ie();d.sdf={};const k=i.height,A=Math.ceil(n.glyphCount/a),O=Math.pow(2,Math.ceil(Math.log2(A*e)));O>k&&(console.info(`Increasing SDF texture size ${k}->${O}`),Kt(i,c,O),r.dispose()),Promise.all(x.map(B=>xt(B,n,y.gpuAccelerateSDF).then(({timing:m})=>{d.sdf[B.atlasIndex]=m}))).then(()=>{x.length&&!n.contextLost&&(kt(n),r.needsUpdate=!0),d.sdfTotal=Ie()-F,d.total=Ie()-v,o(Object.freeze({parameters:y,sdfTexture:r,sdfGlyphSize:e,sdfExponent:t,glyphBounds:h,glyphAtlasIndices:u,glyphColors:l.glyphColors,caretPositions:l.caretPositions,caretHeight:l.caretHeight,chunkedBounds:l.chunkedBounds,ascender:l.ascender,descender:l.descender,lineHeight:l.lineHeight,capHeight:l.capHeight,xHeight:l.xHeight,topBaseline:l.topBaseline,blockBounds:l.blockBounds,visibleBounds:l.visibleBounds,timings:l.timings}))})}),Promise.resolve().then(()=>{n.contextLost||Zt(i)})}function xt({path:y,atlasIndex:o,sdfViewBox:v},{sdfGlyphSize:c,sdfCanvas:t,contextLost:e},a){if(e)return Promise.resolve({timing:-1});const{textureWidth:n,sdfExponent:r}=Be,i=Math.max(v[2]-v[0],v[3]-v[1]),s=Math.floor(o/4),l=s%(n/c)*c,u=Math.floor(s/(n/c))*c,f=o%4;return Ht(c,c,y,v,i,r,t,l,u,f,a)}function or(y){const o=y.sdfCanvas;o.addEventListener("webglcontextlost",v=>{console.log("Context Lost",v),v.preventDefault(),y.contextLost=!0}),o.addEventListener("webglcontextrestored",v=>{console.log("Context Restored",v),y.contextLost=!1;const c=[];y.glyphsByFont.forEach(t=>{t.forEach(e=>{c.push(xt(e,y,!0))})}),Promise.all(c).then(()=>{kt(y),y.sdfTexture.needsUpdate=!0})})}function Dr({font:y,characters:o,sdfGlyphSize:v},c){let t=Array.isArray(o)?o.join(`
`):""+o;Tt({font:y,sdfGlyphSize:v,text:t},c)}function ir(y,o){for(let v in o)o.hasOwnProperty(v)&&(y[v]=o[v]);return y}let Ne;function sr(y){return Ne||(Ne=typeof document>"u"?{}:document.createElement("a")),Ne.href=y,Ne.href}function kt(y){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:o,sdfTexture:v}=y,{width:c,height:t}=o,e=y.sdfCanvas.getContext("webgl");let a=v.image.data;(!a||a.length!==c*t*4)&&(a=new Uint8Array(c*t*4),v.image={width:c,height:t,data:a},v.flipY=!1,v.isDataTexture=!0),e.readPixels(0,0,c,t,e.RGBA,e.UNSIGNED_BYTE,a)}}const lr=qe({name:"Typesetter",dependencies:[Be,nr,Xt,Vt],init(y,o,v,c){const{defaultFontURL:t}=y;return v(o,c(),{defaultFontURL:t})}}),ur=qe({name:"Typesetter",dependencies:[lr],init(y){return function(o){return new Promise(v=>{y.typeset(o,v)})}},getTransferables(y){const o=[y.glyphPositions.buffer,y.glyphIds.buffer];return y.caretPositions&&o.push(y.caretPositions.buffer),y.glyphColors&&o.push(y.glyphColors.buffer),o}}),pt={};function fr(y){let o=pt[y];if(!o){const v=new ot(1,1,y,y),c=v.clone(),t=v.attributes,e=c.attributes,a=new Lt,n=t.uv.count;for(let r=0;r<n;r++)e.position.array[r*3]*=-1,e.normal.array[r*3+2]*=-1;["position","normal","uv"].forEach(r=>{a.setAttribute(r,new Wt([...t[r].array,...e[r].array],t[r].itemSize))}),a.setIndex([...v.index.array,...c.index.array.map(r=>r+n)]),a.translate(.5,.5,0),o=pt[y]=a}return o}const hr="aTroikaGlyphBounds",vt="aTroikaGlyphIndex",dr="aTroikaGlyphColor";class cr extends Ot{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new At,this.boundingBox=new It}computeBoundingSphere(){}computeBoundingBox(){}setSide(o){const v=this.getIndex().count;this.setDrawRange(o===Bt?v/2:0,o===St?v:v/2)}set detail(o){if(o!==this._detail){this._detail=o,(typeof o!="number"||o<1)&&(o=1);let v=fr(o);["position","normal","uv"].forEach(c=>{this.attributes[c]=v.attributes[c].clone()}),this.setIndex(v.getIndex().clone())}}get detail(){return this._detail}set curveRadius(o){o!==this._curveRadius&&(this._curveRadius=o,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(o,v,c,t,e){Ze(this,hr,o,4),Ze(this,vt,v,1),Ze(this,dr,e,3),this._blockBounds=c,this._chunkedBounds=t,this.instanceCount=v.length,this._updateBounds()}_updateBounds(){const o=this._blockBounds;if(o){const{curveRadius:v,boundingBox:c}=this;if(v){const{PI:t,floor:e,min:a,max:n,sin:r,cos:i}=Math,s=t/2,l=t*2,u=Math.abs(v),f=o[0]/u,g=o[2]/u,p=e((f+s)/l)!==e((g+s)/l)?-u:a(r(f)*u,r(g)*u),d=e((f-s)/l)!==e((g-s)/l)?u:n(r(f)*u,r(g)*u),x=e((f+t)/l)!==e((g+t)/l)?u*2:n(u-i(f)*u,u-i(g)*u);c.min.set(p,o[1],v<0?-x:0),c.max.set(d,o[3],v<0?0:x)}else c.min.set(o[0],o[1],0),c.max.set(o[2],o[3],0);c.getBoundingSphere(this.boundingSphere)}}applyClipRect(o){let v=this.getAttribute(vt).count,c=this._chunkedBounds;if(c)for(let t=c.length;t--;){v=c[t].end;let e=c[t].rect;if(e[1]<o.w&&e[3]>o.y&&e[0]<o.z&&e[2]>o.x)break}this.instanceCount=v}}function Ze(y,o,v,c){const t=y.getAttribute(o);v?t&&t.array.length===v.length?(t.array.set(v),t.needsUpdate=!0):(y.setAttribute(o,new Pt(v,c)),delete y._maxInstanceCount,y.dispose()):t&&y.deleteAttribute(o)}const pr=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaDistanceOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,vr=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,gr=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaDistanceOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaOutlineOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,yr=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function mr(y){const o=Nt(y,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new He},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new ut(0,0,0,0)},uTroikaClipRect:{value:new ut(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new He},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new nt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Rt},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:pr,vertexTransform:vr,fragmentDefs:gr,fragmentColorTransform:yr,customRewriter({vertexShader:v,fragmentShader:c}){let t=/\buniform\s+vec3\s+diffuse\b/;return t.test(c)&&(c=c.replace(t,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),t.test(v)||(v=v.replace(jt,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:v,fragmentShader:c}}});return o.transparent=!0,Object.defineProperties(o,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),o}const it=new Mt({color:16777215,side:St,transparent:!0}),gt=8421504,yt=new Et,je=new at,Ke=new at,Me=[],Sr=new at,et="+x+y";function mt(y){return Array.isArray(y)?y[0]:y}let Ft=()=>{const y=new rt(new ot(1,1),it);return Ft=()=>y,y},Ct=()=>{const y=new rt(new ot(1,1,32,1),it);return Ct=()=>y,y};const Ur={type:"syncstart"},br={type:"synccomplete"},wt=["font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],Tr=wt.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class xr extends rt{constructor(){const o=new cr;super(o,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.fontSize=.1,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=gt,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=et,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(o){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(o):(this._isSyncing=!0,this.dispatchEvent(Ur),Tt({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF},v=>{this._isSyncing=!1,this._textRenderInfo=v,this.geometry.updateGlyphs(v.glyphBounds,v.glyphAtlasIndices,v.blockBounds,v.chunkedBounds,v.glyphColors);const c=this._queuedSyncs;c&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{c.forEach(t=>t&&t())})),this.dispatchEvent(br),o&&o()})))}onBeforeRender(o,v,c,t,e,a){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e),e._hadOwnSide=e.hasOwnProperty("side"),this.geometry.setSide(e._actualSide=e.side),e.side=Dt}onAfterRender(o,v,c,t,e,a){e._hadOwnSide?e.side=e._actualSide:delete e.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let o=this._derivedMaterial;const v=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=it.clone());if((!o||o.baseMaterial!==v)&&(o=this._derivedMaterial=mr(v),v.addEventListener("dispose",function c(){v.removeEventListener("dispose",c),o.dispose()})),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let c=o._outlineMtl;return c||(c=o._outlineMtl=Object.create(o,{id:{value:o.id+.1}}),c.isTextOutlineMaterial=!0,c.depthWrite=!1,c.map=null,o.addEventListener("dispose",function t(){o.removeEventListener("dispose",t),c.dispose()})),[c,o]}else return o}set material(o){o&&o.isTroikaTextMaterial?(this._derivedMaterial=o,this._baseMaterial=o.baseMaterial):this._baseMaterial=o}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(o){this.geometry.detail=o}get curveRadius(){return this.geometry.curveRadius}set curveRadius(o){this.geometry.curveRadius=o}get customDepthMaterial(){return mt(this.material).getDepthMaterial()}get customDistanceMaterial(){return mt(this.material).getDistanceMaterial()}_prepareForRender(o){const v=o.isTextOutlineMaterial,c=o.uniforms,t=this.textRenderInfo;if(t){const{sdfTexture:n,blockBounds:r}=t;c.uTroikaSDFTexture.value=n,c.uTroikaSDFTextureSize.value.set(n.image.width,n.image.height),c.uTroikaSDFGlyphSize.value=t.sdfGlyphSize,c.uTroikaSDFExponent.value=t.sdfExponent,c.uTroikaTotalBounds.value.fromArray(r),c.uTroikaUseGlyphColors.value=!v&&!!t.glyphColors;let i=0,s=0,l=0,u,f,g,p=0,d=0;if(v){let{outlineWidth:h,outlineOffsetX:U,outlineOffsetY:T,outlineBlur:S,outlineOpacity:b}=this;i=this._parsePercent(h)||0,s=Math.max(0,this._parsePercent(S)||0),u=b,p=this._parsePercent(U)||0,d=this._parsePercent(T)||0}else l=Math.max(0,this._parsePercent(this.strokeWidth)||0),l&&(g=this.strokeColor,c.uTroikaStrokeColor.value.set(g??gt),f=this.strokeOpacity,f==null&&(f=1)),u=this.fillOpacity;c.uTroikaDistanceOffset.value=i,c.uTroikaPositionOffset.value.set(p,d),c.uTroikaBlurRadius.value=s,c.uTroikaStrokeWidth.value=l,c.uTroikaStrokeOpacity.value=f,c.uTroikaFillOpacity.value=u??1,c.uTroikaCurveRadius.value=this.curveRadius||0;let x=this.clipRect;if(x&&Array.isArray(x)&&x.length===4)c.uTroikaClipRect.value.fromArray(x);else{const h=(this.fontSize||.1)*100;c.uTroikaClipRect.value.set(r[0]-h,r[1]-h,r[2]+h,r[3]+h)}this.geometry.applyClipRect(c.uTroikaClipRect.value)}c.uTroikaSDFDebug.value=!!this.debugSDF,o.polygonOffset=!!this.depthOffset,o.polygonOffsetFactor=o.polygonOffsetUnits=this.depthOffset||0;const e=v?this.outlineColor||0:this.color;if(e==null)delete o.color;else{const n=o.hasOwnProperty("color")?o.color:o.color=new nt;(e!==n._input||typeof e=="object")&&n.set(n._input=e)}let a=this.orientation||et;if(a!==o._orientation){let n=c.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let r=a!==et&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(r){let[,i,s,l,u]=r;je.set(0,0,0)[s]=i==="-"?1:-1,Ke.set(0,0,0)[u]=l==="-"?-1:1,yt.lookAt(Sr,je.cross(Ke),Ke),n.setFromMatrix4(yt)}else n.identity();o._orientation=a}}_parsePercent(o){if(typeof o=="string"){let v=o.match(/^(-?[\d.]+)%$/),c=v?parseFloat(v[1]):NaN;o=(isNaN(c)?0:c/100)*this.fontSize}return o}localPositionToTextCoords(o,v=new He){v.copy(o);const c=this.curveRadius;return c&&(v.x=Math.atan2(o.x,Math.abs(c)-Math.abs(o.z))*Math.abs(c)),v}worldPositionToTextCoords(o,v=new He){return je.copy(o),this.localPositionToTextCoords(this.worldToLocal(je),v)}raycast(o,v){const{textRenderInfo:c,curveRadius:t}=this;if(c){const e=c.blockBounds,a=t?Ct():Ft(),n=a.geometry,{position:r,uv:i}=n.attributes;for(let s=0;s<i.count;s++){let l=e[0]+i.getX(s)*(e[2]-e[0]);const u=e[1]+i.getY(s)*(e[3]-e[1]);let f=0;t&&(f=t-Math.cos(l/t)*t,l=Math.sin(l/t)*t),r.setXYZ(s,l,u,f)}n.boundingSphere=this.geometry.boundingSphere,n.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,Me.length=0,a.raycast(o,Me);for(let s=0;s<Me.length;s++)Me[s].object=this,v.push(Me[s])}}copy(o){const v=this.geometry;return super.copy(o),this.geometry=v,Tr.forEach(c=>{this[c]=o[c]}),this}clone(){return new this.constructor().copy(this)}}wt.forEach(y=>{const o="_private_"+y;Object.defineProperty(xr.prototype,y,{get(){return this[o]},set(v){v!==this[o]&&(this[o]=v,this._needsSync=!0)}})});export{xr as T,Dr as p};
//# sourceMappingURL=troika-three-text-b5beb774.js.map
