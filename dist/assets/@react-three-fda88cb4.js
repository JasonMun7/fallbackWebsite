import{_ as J}from"./@babel-98964cd2.js";import{r as u}from"./react-915dfabc.js";import{L as _e,a as Bt,R as It,U as $t,B as Ht,M as Wt,C as at,b as lt,O as Be,P as Ie,S as De,c as Me,N as Gt,A as Nt,V as ct,d as V,W as qt,e as Ut,f as Vt,g as Xt,h as Zt,i as Yt,T as Kt,D as Jt,j as ue,k as Qt,E as en,l as tn,m as nn,H as rn,n as Ye,o as on,p as sn,q as an,r as Ke}from"./three-ddfced5c.js";import{u as ln}from"./react-use-measure-68d68cee.js";import{F as cn,u as un}from"./its-fine-55834525.js";import{R as fn,c as oe}from"./react-reconciler-01ef72aa.js";import{s as Je}from"./scheduler-765c72db.js";import{c as dn}from"./react-dom-8cac2ab3.js";import{u as pn,a as mn}from"./@react-spring-82fa8876.js";import{u as vn}from"./@use-gesture-de1e5650.js";import{T as hn,p as gn}from"./troika-three-text-b5beb774.js";import{s as ut,p as yn,c as bn}from"./suspend-react-4f9dedb1.js";import{G as $e,D as wn,M as Pe,R as En,E as _n,a as Mn,H as Pn,V as Cn}from"./three-stdlib-9905abc4.js";import{m as xn}from"./react-merge-refs-239dbb3c.js";import{c as ft}from"./zustand-7d50ec68.js";const He={},dt=e=>void Object.assign(He,e);function Sn(e,t){function o(n,{args:r=[],attach:m,...f},d){let w=`${n[0].toUpperCase()}${n.slice(1)}`,h;if(n==="primitive"){if(f.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const c=f.object;h=ne(c,{type:n,root:d,attach:m,primitive:!0})}else{const c=He[w];if(!c)throw new Error(`R3F: ${w} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");h=ne(new c(...r),{type:n,root:d,attach:m,memoizedProps:{args:r}})}return h.__r3f.attach===void 0&&(h instanceof Ht?h.__r3f.attach="geometry":h instanceof Wt&&(h.__r3f.attach="material")),w!=="inject"&&Se(h,f),h}function i(n,r){let m=!1;if(r){var f,d;(f=r.__r3f)!=null&&f.attach?xe(n,r,r.__r3f.attach):r.isObject3D&&n.isObject3D&&(n.add(r),m=!0),m||(d=n.__r3f)==null||d.objects.push(r),r.__r3f||ne(r,{}),r.__r3f.parent=n,ze(r),re(r)}}function s(n,r,m){let f=!1;if(r){var d,w;if((d=r.__r3f)!=null&&d.attach)xe(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){r.parent=n,r.dispatchEvent({type:"added"});const h=n.children.filter(p=>p!==r),c=h.indexOf(m);n.children=[...h.slice(0,c),r,...h.slice(c)],f=!0}f||(w=n.__r3f)==null||w.objects.push(r),r.__r3f||ne(r,{}),r.__r3f.parent=n,ze(r),re(r)}}function l(n,r,m=!1){n&&[...n].forEach(f=>y(r,f,m))}function y(n,r,m){if(r){var f,d,w;if(r.__r3f&&(r.__r3f.parent=null),(f=n.__r3f)!=null&&f.objects&&(n.__r3f.objects=n.__r3f.objects.filter(M=>M!==r)),(d=r.__r3f)!=null&&d.attach)rt(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){var h;n.remove(r),(h=r.__r3f)!=null&&h.root&&Dn(r.__r3f.root,r)}const p=(w=r.__r3f)==null?void 0:w.primitive,b=m===void 0?r.dispose!==null&&!p:m;if(!p){var c;l((c=r.__r3f)==null?void 0:c.objects,r,b),l(r.children,r,b)}delete r.__r3f,b&&r.dispose&&r.type!=="Scene"&&Je.unstable_scheduleCallback(Je.unstable_IdlePriority,()=>{try{r.dispose()}catch{}}),re(n)}}function v(n,r,m,f){var d;const w=(d=n.__r3f)==null?void 0:d.parent;if(!w)return;const h=o(r,m,n.__r3f.root);if(n.children){for(const c of n.children)c.__r3f&&i(h,c);n.children=n.children.filter(c=>!c.__r3f)}n.__r3f.objects.forEach(c=>i(h,c)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||y(w,n),h.parent&&(h.__r3f.autoRemovedBeforeAppend=!0),i(w,h),h.raycast&&h.__r3f.eventCount&&h.__r3f.root.getState().internal.interaction.push(h),[f,f.alternate].forEach(c=>{c!==null&&(c.stateNode=h,c.ref&&(typeof c.ref=="function"?c.ref(h):c.ref.current=h))})}const a=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:fn({createInstance:o,removeChild:y,appendChild:i,appendInitialChild:i,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,r)=>{if(!r)return;const m=n.getState().scene;m.__r3f&&(m.__r3f.root=n,i(m,r))},removeChildFromContainer:(n,r)=>{r&&y(n.getState().scene,r)},insertInContainerBefore:(n,r,m)=>{if(!r||!m)return;const f=n.getState().scene;f.__r3f&&s(f,r,m)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var r;return!!((r=n==null?void 0:n.__r3f)!=null?r:{}).handlers},prepareUpdate(n,r,m,f){var d;if(((d=n==null?void 0:n.__r3f)!=null?d:{}).primitive&&f.object&&f.object!==n)return[!0];{const{args:h=[],children:c,...p}=f,{args:b=[],children:M,...P}=m;if(!Array.isArray(h))throw new Error("R3F: the args prop must be an array!");if(h.some((x,S)=>x!==b[S]))return[!0];const _=bt(n,p,P,!0);return _.changes.length?[!1,_]:null}},commitUpdate(n,[r,m],f,d,w,h){r?v(n,f,w,h):Se(n,m)},commitMount(n,r,m,f){var d;const w=(d=n.__r3f)!=null?d:{};n.raycast&&w.handlers&&w.eventCount&&n.__r3f.root.getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>ne(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var r;const{attach:m,parent:f}=(r=n.__r3f)!=null?r:{};m&&f&&rt(f,n,m),n.isObject3D&&(n.visible=!1),re(n)},unhideInstance(n,r){var m;const{attach:f,parent:d}=(m=n.__r3f)!=null?m:{};f&&d&&xe(d,n,f),(n.isObject3D&&r.visible==null||r.visible)&&(n.visible=!0),re(n)},createTextInstance:a,hideTextInstance:a,unhideTextInstance:a,getCurrentEventPriority:()=>t?t():oe.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&j.fun(performance.now)?performance.now:j.fun(Date.now)?Date.now:()=>0,scheduleTimeout:j.fun(setTimeout)?setTimeout:void 0,cancelTimeout:j.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Se}}var Qe,et;const Ce=e=>"colorSpace"in e||"outputColorSpace"in e,pt=()=>{var e;return(e=He.ColorManagement)!=null?e:null},mt=e=>e&&e.isOrthographicCamera,Rn=e=>e&&e.hasOwnProperty("current"),de=typeof window<"u"&&((Qe=window.document)!=null&&Qe.createElement||((et=window.navigator)==null?void 0:et.product)==="ReactNative")?u.useLayoutEffect:u.useEffect;function vt(e){const t=u.useRef(e);return de(()=>void(t.current=e),[e]),t}function On({set:e}){return de(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class ht extends u.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}ht.getDerivedStateFromError=()=>({error:!0});const gt="__default",tt=new Map,Tn=e=>e&&!!e.memoized&&!!e.changes;function yt(e){var t;const o=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],o),e[1]):e}const le=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},j={obj:e=>e===Object(e)&&!j.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:o="shallow",objects:i="reference",strict:s=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(j.str(e)||j.num(e))return e===t;const l=j.obj(e);if(l&&i==="reference")return e===t;const y=j.arr(e);if(y&&o==="reference")return e===t;if((y||l)&&e===t)return!0;let v;for(v in e)if(!(v in t))return!1;if(l&&o==="shallow"&&i==="shallow"){for(v in s?t:e)if(!j.equ(e[v],t[v],{strict:s,objects:"reference"}))return!1}else for(v in s?t:e)if(e[v]!==t[v])return!1;if(j.und(v)){if(y&&e.length===0&&t.length===0||l&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function kn(e){const t={nodes:{},materials:{}};return e&&e.traverse(o=>{o.name&&(t.nodes[o.name]=o),o.material&&!t.materials[o.material.name]&&(t.materials[o.material.name]=o.material)}),t}function jn(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function ne(e,t){const o=e;return o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Le(e,t){let o=e;if(t.includes("-")){const i=t.split("-"),s=i.pop();return o=i.reduce((l,y)=>l[y],e),{target:o,key:s}}else return{target:o,key:t}}const nt=/-\d+$/;function xe(e,t,o){if(j.str(o)){if(nt.test(o)){const l=o.replace(nt,""),{target:y,key:v}=Le(e,l);Array.isArray(y[v])||(y[v]=[])}const{target:i,key:s}=Le(e,o);t.__r3f.previousAttach=i[s],i[s]=t}else t.__r3f.previousAttach=o(e,t)}function rt(e,t,o){var i,s;if(j.str(o)){const{target:l,key:y}=Le(e,o),v=t.__r3f.previousAttach;v===void 0?delete l[y]:l[y]=v}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(s=t.__r3f)==null||delete s.previousAttach}function bt(e,{children:t,key:o,ref:i,...s},{children:l,key:y,ref:v,...a}={},g=!1){var n;const r=(n=e==null?void 0:e.__r3f)!=null?n:{},m=Object.entries(s),f=[];if(g){const w=Object.keys(a);for(let h=0;h<w.length;h++)s.hasOwnProperty(w[h])||m.unshift([w[h],gt+"remove"])}m.forEach(([w,h])=>{var c;if((c=e.__r3f)!=null&&c.primitive&&w==="object"||j.equ(h,a[w]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(w))return f.push([w,h,!0,[]]);let p=[];w.includes("-")&&(p=w.split("-")),f.push([w,h,!1,p]);for(const b in s){const M=s[b];b.startsWith(`${w}-`)&&f.push([b,M,!1,b.split("-")])}});const d={...s};return r.memoizedProps&&r.memoizedProps.args&&(d.args=r.memoizedProps.args),r.memoizedProps&&r.memoizedProps.attach&&(d.attach=r.memoizedProps.attach),{memoized:d,changes:f}}function Se(e,t){var o,i,s;const l=(o=e.__r3f)!=null?o:{},y=l.root,v=(i=y==null||y.getState==null?void 0:y.getState())!=null?i:{},{memoized:a,changes:g}=Tn(t)?t:bt(e,t),n=l.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let m=0;m<g.length;m++){let[f,d,w,h]=g[m];if(Ce(e)){const M="srgb",P="srgb-linear";f==="encoding"?(f="colorSpace",d=d===3001?M:P):f==="outputEncoding"&&(f="outputColorSpace",d=d===3001?M:P)}let c=e,p=c[f];if(h.length&&(p=h.reduce((b,M)=>b[M],e),!(p&&p.set))){const[b,...M]=h.reverse();c=M.reverse().reduce((P,_)=>P[_],e),f=b}if(d===gt+"remove")if(c.constructor){let b=tt.get(c.constructor);b||(b=new c.constructor,tt.set(c.constructor,b)),d=b[f]}else d=0;if(w)d?l.handlers[f]=d:delete l.handlers[f],l.eventCount=Object.keys(l.handlers).length;else if(p&&p.set&&(p.copy||p instanceof _e)){if(Array.isArray(d))p.fromArray?p.fromArray(d):p.set(...d);else if(p.copy&&d&&d.constructor&&p.constructor===d.constructor)p.copy(d);else if(d!==void 0){const b=p instanceof at;!b&&p.setScalar?p.setScalar(d):p instanceof _e&&d instanceof _e?p.mask=d.mask:p.set(d),!pt()&&!v.linear&&b&&p.convertSRGBToLinear()}}else if(c[f]=d,c[f]instanceof Bt&&c[f].format===It&&c[f].type===$t){const b=c[f];Ce(b)&&Ce(v.gl)?b.colorSpace=v.gl.outputColorSpace:b.encoding=v.gl.outputEncoding}re(e)}if(l.parent&&v.internal&&e.raycast&&n!==l.eventCount){const m=v.internal.interaction.indexOf(e);m>-1&&v.internal.interaction.splice(m,1),l.eventCount&&v.internal.interaction.push(e)}return!(g.length===1&&g[0][0]==="onUpdate")&&g.length&&(s=e.__r3f)!=null&&s.parent&&ze(e),e}function re(e){var t,o;const i=(t=e.__r3f)==null||(o=t.root)==null||o.getState==null?void 0:o.getState();i&&i.internal.frames===0&&i.invalidate()}function ze(e){e.onUpdate==null||e.onUpdate(e)}function wt(e,t){e.manual||(mt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function ge(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function An(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return oe.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return oe.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return oe.ContinuousEventPriority;default:return oe.DefaultEventPriority}}function Et(e,t,o,i){const s=o.get(t);s&&(o.delete(t),o.size===0&&(e.delete(i),s.target.releasePointerCapture(i)))}function Dn(e,t){const{internal:o}=e.getState();o.interaction=o.interaction.filter(i=>i!==t),o.initialHits=o.initialHits.filter(i=>i!==t),o.hovered.forEach((i,s)=>{(i.eventObject===t||i.object===t)&&o.hovered.delete(s)}),o.capturedMap.forEach((i,s)=>{Et(o.capturedMap,t,i,s)})}function Ln(e){function t(a){const{internal:g}=e.getState(),n=a.offsetX-g.initialClick[0],r=a.offsetY-g.initialClick[1];return Math.round(Math.sqrt(n*n+r*r))}function o(a){return a.filter(g=>["Move","Over","Enter","Out","Leave"].some(n=>{var r;return(r=g.__r3f)==null?void 0:r.handlers["onPointer"+n]}))}function i(a,g){const n=e.getState(),r=new Set,m=[],f=g?g(n.internal.interaction):n.internal.interaction;for(let c=0;c<f.length;c++){const p=le(f[c]);p&&(p.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(a,n);function d(c){const p=le(c);if(!p||!p.events.enabled||p.raycaster.camera===null)return[];if(p.raycaster.camera===void 0){var b;p.events.compute==null||p.events.compute(a,p,(b=p.previousRoot)==null?void 0:b.getState()),p.raycaster.camera===void 0&&(p.raycaster.camera=null)}return p.raycaster.camera?p.raycaster.intersectObject(c,!0):[]}let w=f.flatMap(d).sort((c,p)=>{const b=le(c.object),M=le(p.object);return!b||!M?c.distance-p.distance:M.events.priority-b.events.priority||c.distance-p.distance}).filter(c=>{const p=ge(c);return r.has(p)?!1:(r.add(p),!0)});n.events.filter&&(w=n.events.filter(w,n));for(const c of w){let p=c.object;for(;p;){var h;(h=p.__r3f)!=null&&h.eventCount&&m.push({...c,eventObject:p}),p=p.parent}}if("pointerId"in a&&n.internal.capturedMap.has(a.pointerId))for(let c of n.internal.capturedMap.get(a.pointerId).values())r.has(ge(c.intersection))||m.push(c.intersection);return m}function s(a,g,n,r){const m=e.getState();if(a.length){const f={stopped:!1};for(const d of a){const w=le(d.object)||m,{raycaster:h,pointer:c,camera:p,internal:b}=w,M=new V(c.x,c.y,0).unproject(p),P=R=>{var E,O;return(E=(O=b.capturedMap.get(R))==null?void 0:O.has(d.eventObject))!=null?E:!1},_=R=>{const E={intersection:d,target:g.target};b.capturedMap.has(R)?b.capturedMap.get(R).set(d.eventObject,E):b.capturedMap.set(R,new Map([[d.eventObject,E]])),g.target.setPointerCapture(R)},x=R=>{const E=b.capturedMap.get(R);E&&Et(b.capturedMap,d.eventObject,E,R)};let S={};for(let R in g){let E=g[R];typeof E!="function"&&(S[R]=E)}let C={...d,...S,pointer:c,intersections:a,stopped:f.stopped,delta:n,unprojectedPoint:M,ray:h.ray,camera:p,stopPropagation(){const R="pointerId"in g&&b.capturedMap.get(g.pointerId);if((!R||R.has(d.eventObject))&&(C.stopped=f.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(E=>E.eventObject===d.eventObject))){const E=a.slice(0,a.indexOf(d));l([...E,d])}},target:{hasPointerCapture:P,setPointerCapture:_,releasePointerCapture:x},currentTarget:{hasPointerCapture:P,setPointerCapture:_,releasePointerCapture:x},nativeEvent:g};if(r(C),f.stopped===!0)break}}return a}function l(a){const{internal:g}=e.getState();for(const n of g.hovered.values())if(!a.length||!a.find(r=>r.object===n.object&&r.index===n.index&&r.instanceId===n.instanceId)){const m=n.eventObject.__r3f,f=m==null?void 0:m.handlers;if(g.hovered.delete(ge(n)),m!=null&&m.eventCount){const d={...n,intersections:a};f.onPointerOut==null||f.onPointerOut(d),f.onPointerLeave==null||f.onPointerLeave(d)}}}function y(a,g){for(let n=0;n<g.length;n++){const r=g[n].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(a)}}function v(a){switch(a){case"onPointerLeave":case"onPointerCancel":return()=>l([]);case"onLostPointerCapture":return g=>{const{internal:n}=e.getState();"pointerId"in g&&n.capturedMap.has(g.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(g.pointerId)&&(n.capturedMap.delete(g.pointerId),l([]))})}}return function(n){const{onPointerMissed:r,internal:m}=e.getState();m.lastEvent.current=n;const f=a==="onPointerMove",d=a==="onClick"||a==="onContextMenu"||a==="onDoubleClick",h=i(n,f?o:void 0),c=d?t(n):0;a==="onPointerDown"&&(m.initialClick=[n.offsetX,n.offsetY],m.initialHits=h.map(b=>b.eventObject)),d&&!h.length&&c<=2&&(y(n,m.interaction),r&&r(n)),f&&l(h);function p(b){const M=b.eventObject,P=M.__r3f,_=P==null?void 0:P.handlers;if(P!=null&&P.eventCount)if(f){if(_.onPointerOver||_.onPointerEnter||_.onPointerOut||_.onPointerLeave){const x=ge(b),S=m.hovered.get(x);S?S.stopped&&b.stopPropagation():(m.hovered.set(x,b),_.onPointerOver==null||_.onPointerOver(b),_.onPointerEnter==null||_.onPointerEnter(b))}_.onPointerMove==null||_.onPointerMove(b)}else{const x=_[a];x?(!d||m.initialHits.includes(M))&&(y(n,m.interaction.filter(S=>!m.initialHits.includes(S))),x(b)):d&&m.initialHits.includes(M)&&y(n,m.interaction.filter(S=>!m.initialHits.includes(S)))}}s(h,n,c,p)}}return{handlePointer:v}}const zn=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],_t=e=>!!(e!=null&&e.render),We=u.createContext(null),Fn=(e,t)=>{const o=ft((v,a)=>{const g=new V,n=new V,r=new V;function m(c=a().camera,p=n,b=a().size){const{width:M,height:P,top:_,left:x}=b,S=M/P;p instanceof V?r.copy(p):r.set(...p);const C=c.getWorldPosition(g).distanceTo(r);if(mt(c))return{width:M/c.zoom,height:P/c.zoom,top:_,left:x,factor:1,distance:C,aspect:S};{const R=c.fov*Math.PI/180,E=2*Math.tan(R/2)*C,O=E*(M/P);return{width:O,height:E,top:_,left:x,factor:M/O,distance:C,aspect:S}}}let f;const d=c=>v(p=>({performance:{...p.performance,current:c}})),w=new ct;return{set:v,get:a,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(c=1)=>e(a(),c),advance:(c,p)=>t(c,p,a()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Yt,pointer:w,mouse:w,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const c=a();f&&clearTimeout(f),c.performance.current!==c.performance.min&&d(c.performance.min),f=setTimeout(()=>d(a().performance.max),c.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:m},setEvents:c=>v(p=>({...p,events:{...p.events,...c}})),setSize:(c,p,b,M,P)=>{const _=a().camera,x={width:c,height:p,top:M||0,left:P||0,updateStyle:b};v(S=>({size:x,viewport:{...S.viewport,...m(_,n,x)}}))},setDpr:c=>v(p=>{const b=yt(c);return{viewport:{...p.viewport,dpr:b,initialDpr:p.viewport.initialDpr||b}}}),setFrameloop:(c="always")=>{const p=a().clock;p.stop(),p.elapsedTime=0,c!=="never"&&(p.start(),p.elapsedTime=0),v(()=>({frameloop:c}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:u.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(c,p,b)=>{const M=a().internal;return M.priority=M.priority+(p>0?1:0),M.subscribers.push({ref:c,priority:p,store:b}),M.subscribers=M.subscribers.sort((P,_)=>P.priority-_.priority),()=>{const P=a().internal;P!=null&&P.subscribers&&(P.priority=P.priority-(p>0?1:0),P.subscribers=P.subscribers.filter(_=>_.ref!==c))}}}}}),i=o.getState();let s=i.size,l=i.viewport.dpr,y=i.camera;return o.subscribe(()=>{const{camera:v,size:a,viewport:g,gl:n,set:r}=o.getState();if(a!==s||g.dpr!==l){var m;s=a,l=g.dpr,wt(v,a),n.setPixelRatio(g.dpr);const f=(m=a.updateStyle)!=null?m:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(a.width,a.height,f)}v!==y&&(y=v,r(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(v)}})))}),o.subscribe(v=>e(v)),o};function Bn(e,t){const o={callback:e};return t.add(o),()=>void t.delete(o)}let ye,Mt=new Set,In=new Set,$n=new Set;const Cr=e=>Bn(e,Mt);function Re(e,t){if(e.size)for(const{callback:o}of e.values())o(t)}function ce(e,t){switch(e){case"before":return Re(Mt,t);case"after":return Re(In,t);case"tail":return Re($n,t)}}let Oe,Te;function ke(e,t,o){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Oe=t.internal.subscribers,ye=0;ye<Oe.length;ye++)Te=Oe[ye],Te.ref.current(Te.store.getState(),i,o);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Hn(e){let t=!1,o,i,s;function l(a){i=requestAnimationFrame(l),t=!0,o=0,ce("before",a);for(const n of e.values()){var g;s=n.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((g=s.gl.xr)!=null&&g.isPresenting)&&(o+=ke(a,s))}if(ce("after",a),o===0)return ce("tail",a),t=!1,cancelAnimationFrame(i)}function y(a,g=1){var n;if(!a)return e.forEach(r=>y(r.store.getState()),g);(n=a.gl.xr)!=null&&n.isPresenting||!a.internal.active||a.frameloop==="never"||(a.internal.frames=Math.min(60,a.internal.frames+g),t||(t=!0,requestAnimationFrame(l)))}function v(a,g=!0,n,r){if(g&&ce("before",a),n)ke(a,n,r);else for(const m of e.values())ke(a,m.store.getState());g&&ce("after",a)}return{loop:l,invalidate:y,advance:v}}function Ge(){const e=u.useContext(We);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function q(e=o=>o,t){return Ge()(e,t)}function we(e,t=0){const o=Ge(),i=o.getState().internal.subscribe,s=vt(e);return de(()=>i(s,t,o),[t,i,o]),null}function Pt(e,t){return function(o,...i){const s=new o;return e&&e(s),Promise.all(i.map(l=>new Promise((y,v)=>s.load(l,a=>{a.scene&&Object.assign(a,kn(a.scene)),y(a)},t,a=>v(new Error(`Could not load ${l}: ${a.message}`))))))}}function se(e,t,o,i){const s=Array.isArray(t)?t:[t],l=ut(Pt(o,i),[e,...s],{equal:j.equ});return Array.isArray(t)?l:l[0]}se.preload=function(e,t,o){const i=Array.isArray(t)?t:[t];return yn(Pt(o),[e,...i])};se.clear=function(e,t){const o=Array.isArray(t)?t:[t];return bn([e,...o])};const ie=new Map,{invalidate:ot,advance:it}=Hn(ie),{reconciler:fe,applyProps:ee}=Sn(ie,An),te={objects:"shallow",strict:!1},Wn=(e,t)=>{const o=typeof e=="function"?e(t):e;return _t(o)?o:new qt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Gn(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:o,height:i,top:s,left:l}=e.parentElement.getBoundingClientRect();return{width:o,height:i,top:s,left:l}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function Nn(e){const t=ie.get(e),o=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,l=i||Fn(ot,it),y=o||fe.createContainer(l,oe.ConcurrentRoot,null,!1,null,"",s,null);t||ie.set(e,{fiber:y,store:l});let v,a=!1,g;return{configure(n={}){let{gl:r,size:m,scene:f,events:d,onCreated:w,shadows:h=!1,linear:c=!1,flat:p=!1,legacy:b=!1,orthographic:M=!1,frameloop:P="always",dpr:_=[1,2],performance:x,raycaster:S,camera:C,onPointerMissed:R}=n,E=l.getState(),O=E.gl;E.gl||E.set({gl:O=Wn(r,e)});let $=E.raycaster;$||E.set({raycaster:$=new lt});const{params:I,...L}=S||{};if(j.equ(L,$,te)||ee($,{...L}),j.equ(I,$.params,te)||ee($,{params:{...$.params,...I}}),!E.camera||E.camera===g&&!j.equ(g,C,te)){g=C;const D=C instanceof Ut,T=D?C:M?new Be(0,0,0,0,.1,1e3):new Ie(75,0,.1,1e3);D||(T.position.z=5,C&&ee(T,C),!E.camera&&!(C!=null&&C.rotation)&&T.lookAt(0,0,0)),E.set({camera:T})}if(!E.scene){let D;f instanceof De?D=f:(D=new De,f&&ee(D,f)),E.set({scene:ne(D)})}if(!E.xr){var G;const D=(z,me)=>{const ve=l.getState();ve.frameloop!=="never"&&it(z,!0,ve,me)},T=()=>{const z=l.getState();z.gl.xr.enabled=z.gl.xr.isPresenting,z.gl.xr.setAnimationLoop(z.gl.xr.isPresenting?D:null),z.gl.xr.isPresenting||ot(z)},N={connect(){const z=l.getState().gl;z.xr.addEventListener("sessionstart",T),z.xr.addEventListener("sessionend",T)},disconnect(){const z=l.getState().gl;z.xr.removeEventListener("sessionstart",T),z.xr.removeEventListener("sessionend",T)}};typeof((G=O.xr)==null?void 0:G.addEventListener)=="function"&&N.connect(),E.set({xr:N})}if(O.shadowMap){const D=O.shadowMap.enabled,T=O.shadowMap.type;if(O.shadowMap.enabled=!!h,j.boo(h))O.shadowMap.type=Me;else if(j.str(h)){var F;const N={basic:Vt,percentage:Xt,soft:Me,variance:Zt};O.shadowMap.type=(F=N[h])!=null?F:Me}else j.obj(h)&&Object.assign(O.shadowMap,h);(D!==O.shadowMap.enabled||T!==O.shadowMap.type)&&(O.shadowMap.needsUpdate=!0)}const B=pt();B&&("enabled"in B?B.enabled=!b:"legacyMode"in B&&(B.legacyMode=b)),ee(O,{outputEncoding:c?3e3:3001,toneMapping:p?Gt:Nt}),E.legacy!==b&&E.set(()=>({legacy:b})),E.linear!==c&&E.set(()=>({linear:c})),E.flat!==p&&E.set(()=>({flat:p})),r&&!j.fun(r)&&!_t(r)&&!j.equ(r,O,te)&&ee(O,r),d&&!E.events.handlers&&E.set({events:d(l)});const A=Gn(e,m);return j.equ(A,E.size,te)||E.setSize(A.width,A.height,A.updateStyle,A.top,A.left),_&&E.viewport.dpr!==yt(_)&&E.setDpr(_),E.frameloop!==P&&E.setFrameloop(P),E.onPointerMissed||E.set({onPointerMissed:R}),x&&!j.equ(x,E.performance,te)&&E.set(D=>({performance:{...D.performance,...x}})),v=w,a=!0,this},render(n){return a||this.configure(),fe.updateContainer(u.createElement(qn,{store:l,children:n,onCreated:v,rootElement:e}),y,null,()=>{}),l},unmount(){Ct(e)}}}function qn({store:e,children:t,onCreated:o,rootElement:i}){return de(()=>{const s=e.getState();s.set(l=>({internal:{...l.internal,active:!0}})),o&&o(s),e.getState().events.connected||s.events.connect==null||s.events.connect(i)},[]),u.createElement(We.Provider,{value:e},t)}function Ct(e,t){const o=ie.get(e),i=o==null?void 0:o.fiber;if(i){const s=o==null?void 0:o.store.getState();s&&(s.internal.active=!1),fe.updateContainer(null,i,null,()=>{s&&setTimeout(()=>{try{var l,y,v,a;s.events.disconnect==null||s.events.disconnect(),(l=s.gl)==null||(y=l.renderLists)==null||y.dispose==null||y.dispose(),(v=s.gl)==null||v.forceContextLoss==null||v.forceContextLoss(),(a=s.gl)!=null&&a.xr&&s.xr.disconnect(),jn(s),ie.delete(e),t&&t(e)}catch{}},500)})}}function Un(e,t,o){return u.createElement(Vn,{key:t.uuid,children:e,container:t,state:o})}function Vn({state:e={},children:t,container:o}){const{events:i,size:s,...l}=e,y=Ge(),[v]=u.useState(()=>new lt),[a]=u.useState(()=>new ct),g=u.useCallback((r,m)=>{const f={...r};Object.keys(r).forEach(w=>{(zn.includes(w)||r[w]!==m[w]&&m[w])&&delete f[w]});let d;if(m&&s){const w=m.camera;d=r.viewport.getCurrentViewport(w,new V,s),w!==r.camera&&wt(w,s)}return{...f,scene:o,raycaster:v,pointer:a,mouse:a,previousRoot:y,events:{...r.events,...m==null?void 0:m.events,...i},size:{...r.size,...s},viewport:{...r.viewport,...d},...l}},[e]),[n]=u.useState(()=>{const r=y.getState();return ft((f,d)=>({...r,scene:o,raycaster:v,pointer:a,mouse:a,previousRoot:y,events:{...r.events,...i},size:{...r.size,...s},...l,set:f,get:d,setEvents:w=>f(h=>({...h,events:{...h.events,...w}}))}))});return u.useEffect(()=>{const r=y.subscribe(m=>n.setState(f=>g(m,f)));return()=>{r(),n.destroy()}},[]),u.useEffect(()=>{n.setState(r=>g(y.getState(),r))},[g]),u.createElement(u.Fragment,null,fe.createPortal(u.createElement(We.Provider,{value:n},t),n,null))}fe.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:u.version});const je={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Xn(e){const{handlePointer:t}=Ln(e);return{priority:1,enabled:!0,compute(o,i,s){i.pointer.set(o.offsetX/i.size.width*2-1,-(o.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(je).reduce((o,i)=>({...o,[i]:t(i)}),{}),update:()=>{var o;const{events:i,internal:s}=e.getState();(o=s.lastEvent)!=null&&o.current&&i.handlers&&i.handlers.onPointerMove(s.lastEvent.current)},connect:o=>{var i;const{set:s,events:l}=e.getState();l.disconnect==null||l.disconnect(),s(y=>({events:{...y.events,connected:o}})),Object.entries((i=l.handlers)!=null?i:[]).forEach(([y,v])=>{const[a,g]=je[y];o.addEventListener(a,v,{passive:g})})},disconnect:()=>{const{set:o,events:i}=e.getState();if(i.connected){var s;Object.entries((s=i.handlers)!=null?s:[]).forEach(([l,y])=>{if(i&&i.connected instanceof HTMLElement){const[v]=je[l];i.connected.removeEventListener(v,y)}}),o(l=>({events:{...l.events,connected:void 0}}))}}}}const Zn=u.forwardRef(function({children:t,fallback:o,resize:i,style:s,gl:l,events:y=Xn,eventSource:v,eventPrefix:a,shadows:g,linear:n,flat:r,legacy:m,orthographic:f,frameloop:d,dpr:w,performance:h,raycaster:c,camera:p,scene:b,onPointerMissed:M,onCreated:P,..._},x){u.useMemo(()=>dt(Kt),[]);const S=un(),[C,R]=ln({scroll:!0,debounce:{scroll:50,resize:0},...i}),E=u.useRef(null),O=u.useRef(null);u.useImperativeHandle(x,()=>E.current);const $=vt(M),[I,L]=u.useState(!1),[G,F]=u.useState(!1);if(I)throw I;if(G)throw G;const B=u.useRef(null);de(()=>{const H=E.current;R.width>0&&R.height>0&&H&&(B.current||(B.current=Nn(H)),B.current.configure({gl:l,events:y,shadows:g,linear:n,flat:r,legacy:m,orthographic:f,frameloop:d,dpr:w,performance:h,raycaster:c,camera:p,scene:b,size:R,onPointerMissed:(...A)=>$.current==null?void 0:$.current(...A),onCreated:A=>{A.events.connect==null||A.events.connect(v?Rn(v)?v.current:v:O.current),a&&A.setEvents({compute:(D,T)=>{const N=D[a+"X"],z=D[a+"Y"];T.pointer.set(N/T.size.width*2-1,-(z/T.size.height)*2+1),T.raycaster.setFromCamera(T.pointer,T.camera)}}),P==null||P(A)}}),B.current.render(u.createElement(S,null,u.createElement(ht,{set:F},u.createElement(u.Suspense,{fallback:u.createElement(On,{set:L})},t)))))}),u.useEffect(()=>{const H=E.current;if(H)return()=>Ct(H)},[]);const U=v?"none":"auto";return u.createElement("div",J({ref:O,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:U,...s}},_),u.createElement("div",{ref:C,style:{width:"100%",height:"100%"}},u.createElement("canvas",{ref:E,style:{display:"block"}},o)))}),xr=u.forwardRef(function(t,o){return u.createElement(cn,null,u.createElement(Zn,J({},t,{ref:o})))}),pe=new V,Ne=new V,Yn=new V;function Kn(e,t,o){const i=pe.setFromMatrixPosition(e.matrixWorld);i.project(t);const s=o.width/2,l=o.height/2;return[i.x*s+s,-(i.y*l)+l]}function Jn(e,t){const o=pe.setFromMatrixPosition(e.matrixWorld),i=Ne.setFromMatrixPosition(t.matrixWorld),s=o.sub(i),l=t.getWorldDirection(Yn);return s.angleTo(l)>Math.PI/2}function Qn(e,t,o,i){const s=pe.setFromMatrixPosition(e.matrixWorld),l=s.clone();l.project(t),o.setFromCamera(l,t);const y=o.intersectObjects(i,!0);if(y.length){const v=y[0].distance;return s.distanceTo(o.ray.origin)<v}return!0}function er(e,t){if(t instanceof Be)return t.zoom;if(t instanceof Ie){const o=pe.setFromMatrixPosition(e.matrixWorld),i=Ne.setFromMatrixPosition(t.matrixWorld),s=t.fov*Math.PI/180,l=o.distanceTo(i);return 1/(2*Math.tan(s/2)*l)}else return 1}function tr(e,t,o){if(t instanceof Ie||t instanceof Be){const i=pe.setFromMatrixPosition(e.matrixWorld),s=Ne.setFromMatrixPosition(t.matrixWorld),l=i.distanceTo(s),y=(o[1]-o[0])/(t.far-t.near),v=o[1]-y*t.far;return Math.round(y*l+v)}}const Fe=e=>Math.abs(e)<1e-10?0:e;function xt(e,t,o=""){let i="matrix3d(";for(let s=0;s!==16;s++)i+=Fe(t[s]*e.elements[s])+(s!==15?",":")");return o+i}const nr=(e=>t=>xt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),rr=(e=>(t,o)=>xt(t,e(o),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function or(e){return e&&typeof e=="object"&&"current"in e}const Sr=u.forwardRef(({children:e,eps:t=.001,style:o,className:i,prepend:s,center:l,fullscreen:y,portal:v,distanceFactor:a,sprite:g=!1,transform:n=!1,occlude:r,onOcclude:m,castShadow:f,receiveShadow:d,material:w,geometry:h,zIndexRange:c=[16777271,0],calculatePosition:p=Kn,as:b="div",wrapperClass:M,pointerEvents:P="auto",..._},x)=>{const{gl:S,camera:C,scene:R,size:E,raycaster:O,events:$,viewport:I}=q(),[L]=u.useState(()=>document.createElement(b)),G=u.useRef(),F=u.useRef(null),B=u.useRef(0),U=u.useRef([0,0]),H=u.useRef(null),A=u.useRef(null),D=(v==null?void 0:v.current)||$.connected||S.domElement.parentNode,T=u.useRef(null),N=u.useRef(!1),z=u.useMemo(()=>r&&r!=="blending"||Array.isArray(r)&&r.length&&or(r[0]),[r]);u.useLayoutEffect(()=>{const W=S.domElement;r&&r==="blending"?(W.style.zIndex=`${Math.floor(c[0]/2)}`,W.style.position="absolute",W.style.pointerEvents="none"):(W.style.zIndex=null,W.style.position=null,W.style.pointerEvents=null)},[r]),u.useLayoutEffect(()=>{if(F.current){const W=G.current=dn(L);if(R.updateMatrixWorld(),n)L.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const k=p(F.current,C,E);L.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${k[0]}px,${k[1]}px,0);transform-origin:0 0;`}return D&&(s?D.prepend(L):D.appendChild(L)),()=>{D&&D.removeChild(L),W.unmount()}}},[D,n]),u.useLayoutEffect(()=>{M&&(L.className=M)},[M]);const me=u.useMemo(()=>n?{position:"absolute",top:0,left:0,width:E.width,height:E.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:l?"translate3d(-50%,-50%,0)":"none",...y&&{top:-E.height/2,left:-E.width/2,width:E.width,height:E.height},...o},[o,l,y,E,n]),ve=u.useMemo(()=>({position:"absolute",pointerEvents:P}),[P]);u.useLayoutEffect(()=>{if(N.current=!1,n){var W;(W=G.current)==null||W.render(u.createElement("div",{ref:H,style:me},u.createElement("div",{ref:A,style:ve},u.createElement("div",{ref:x,className:i,style:o,children:e}))))}else{var k;(k=G.current)==null||k.render(u.createElement("div",{ref:x,style:me,className:i,children:e}))}});const Q=u.useRef(!0);we(W=>{if(F.current){C.updateMatrixWorld(),F.current.updateWorldMatrix(!0,!1);const k=n?U.current:p(F.current,C,E);if(n||Math.abs(B.current-C.zoom)>t||Math.abs(U.current[0]-k[0])>t||Math.abs(U.current[1]-k[1])>t){const Z=Jn(F.current,C);let X=!1;z&&(Array.isArray(r)?X=r.map(Y=>Y.current):r!=="blending"&&(X=[R]));const ae=Q.current;if(X){const Y=Qn(F.current,C,O,X);Q.current=Y&&!Z}else Q.current=!Z;ae!==Q.current&&(m?m(!Q.current):L.style.display=Q.current?"block":"none");const he=Math.floor(c[0]/2),kt=r?z?[c[0],he]:[he-1,0]:c;if(L.style.zIndex=`${tr(F.current,C,kt)}`,n){const[Y,Xe]=[E.width/2,E.height/2],Ee=C.projectionMatrix.elements[5]*Xe,{isOrthographicCamera:Ze,top:jt,left:At,bottom:Dt,right:Lt}=C,zt=nr(C.matrixWorldInverse),Ft=Ze?`scale(${Ee})translate(${Fe(-(Lt+At)/2)}px,${Fe((jt+Dt)/2)}px)`:`translateZ(${Ee}px)`;let K=F.current.matrixWorld;g&&(K=C.matrixWorldInverse.clone().transpose().copyPosition(K).scale(F.current.scale),K.elements[3]=K.elements[7]=K.elements[11]=0,K.elements[15]=1),L.style.width=E.width+"px",L.style.height=E.height+"px",L.style.perspective=Ze?"":`${Ee}px`,H.current&&A.current&&(H.current.style.transform=`${Ft}${zt}translate(${Y}px,${Xe}px)`,A.current.style.transform=rr(K,1/((a||10)/400)))}else{const Y=a===void 0?1:er(F.current,C)*a;L.style.transform=`translate3d(${k[0]}px,${k[1]}px,0) scale(${Y})`}U.current=k,B.current=C.zoom}}if(!z&&T.current&&!N.current)if(n){if(H.current){const k=H.current.children[0];if(k!=null&&k.clientWidth&&k!=null&&k.clientHeight){const{isOrthographicCamera:Z}=C;if(Z||h)_.scale&&(Array.isArray(_.scale)?_.scale instanceof V?T.current.scale.copy(_.scale.clone().divideScalar(1)):T.current.scale.set(1/_.scale[0],1/_.scale[1],1/_.scale[2]):T.current.scale.setScalar(1/_.scale));else{const X=(a||10)/400,ae=k.clientWidth*X,he=k.clientHeight*X;T.current.scale.set(ae,he,1)}N.current=!0}}}else{const k=L.children[0];if(k!=null&&k.clientWidth&&k!=null&&k.clientHeight){const Z=1/I.factor,X=k.clientWidth*Z,ae=k.clientHeight*Z;T.current.scale.set(X,ae,1),N.current=!0}T.current.lookAt(W.camera.position)}});const Ve=u.useMemo(()=>({vertexShader:n?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[n]);return u.createElement("group",J({},_,{ref:F}),r&&!z&&u.createElement("mesh",{castShadow:f,receiveShadow:d,ref:T},h||u.createElement("planeGeometry",null),w||u.createElement("shaderMaterial",{side:Jt,vertexShader:Ve.vertexShader,fragmentShader:Ve.fragmentShader})))});function Rr({enabled:e=!0,snap:t,global:o,domElement:i,cursor:s=!0,children:l,speed:y=1,rotation:v=[0,0,0],zoom:a=1,polar:g=[0,Math.PI/2],azimuth:n=[-1/0,1/0],config:r={mass:1,tension:170,friction:26}}){const m=q(_=>_.events),f=q(_=>_.gl),d=i||m.connected||f.domElement,{size:w}=q(),h=u.useMemo(()=>[v[0]+g[0],v[0]+g[1]],[v[0],g[0],g[1]]),c=u.useMemo(()=>[v[1]+n[0],v[1]+n[1]],[v[1],n[0],n[1]]),p=u.useMemo(()=>[ue.clamp(v[0],...h),ue.clamp(v[1],...c),v[2]],[v[0],v[1],v[2],h,c]),[b,M]=pn(()=>({scale:1,rotation:p,config:r}));u.useEffect(()=>void M.start({scale:1,rotation:p,config:r}),[p]),u.useEffect(()=>{if(o&&s&&e)return d.style.cursor="grab",f.domElement.style.cursor="",()=>{d.style.cursor="default",f.domElement.style.cursor="default"}},[o,s,d,e]);const P=vn({onHover:({last:_})=>{s&&!o&&e&&(d.style.cursor=_?"auto":"grab")},onDrag:({down:_,delta:[x,S],memo:[C,R]=b.rotation.animation.to||p})=>{if(!e)return[S,x];s&&(d.style.cursor=_?"grabbing":"grab"),x=ue.clamp(R+x/w.width*Math.PI*y,...c),S=ue.clamp(C+S/w.height*Math.PI*y,...h);const E=t&&!_&&typeof t!="boolean"?t:r;return M.start({scale:_&&S>h[1]/2?a:1,rotation:t&&!_?p:[S,x,0],config:O=>O==="scale"?{...E,friction:E.friction*3}:E}),[S,x]}},{target:o?d:void 0});return u.createElement(mn.group,J({},P==null?void 0:P(),b),l)}const Or=u.forwardRef(({sdfGlyphSize:e=64,anchorX:t="center",anchorY:o="middle",font:i,fontSize:s=1,children:l,characters:y,onSync:v,...a},g)=>{const n=q(({invalidate:d})=>d),[r]=u.useState(()=>new hn),[m,f]=u.useMemo(()=>{const d=[];let w="";return u.Children.forEach(l,h=>{typeof h=="string"||typeof h=="number"?w+=h:d.push(h)}),[d,w]},[l]);return ut(()=>new Promise(d=>gn({font:i,characters:y},d)),["troika-text",i,y]),u.useLayoutEffect(()=>void r.sync(()=>{n(),v&&v(r)})),u.useEffect(()=>()=>r.dispose(),[r]),u.createElement("primitive",J({object:r,ref:g,font:i,text:f,anchorX:t,anchorY:o,fontSize:s,sdfGlyphSize:e},a),m)});let be=null;function St(e,t,o){return i=>{o&&o(i),e&&(be||(be=new wn),be.setDecoderPath(typeof e=="string"?e:"https://www.gstatic.com/draco/versioned/decoders/1.5.5/"),i.setDRACOLoader(be)),t&&i.setMeshoptDecoder(typeof Pe=="function"?Pe():Pe)}}function Rt(e,t=!0,o=!0,i){return se($e,e,St(t,o,i))}Rt.preload=(e,t=!0,o=!0,i)=>se.preload($e,e,St(t,o,i));Rt.clear=e=>se.clear($e,e);const Tr=u.forwardRef(({children:e,enabled:t=!0,speed:o=1,rotationIntensity:i=1,floatIntensity:s=1,floatingRange:l=[-.1,.1],...y},v)=>{const a=u.useRef(null),g=u.useRef(Math.random()*1e4);return we(n=>{var r,m;if(!t||o===0)return;const f=g.current+n.clock.getElapsedTime();a.current.rotation.x=Math.cos(f/4*o)/8*i,a.current.rotation.y=Math.sin(f/4*o)/8*i,a.current.rotation.z=Math.sin(f/4*o)/20*i;let d=Math.sin(f/4*o)/10;d=ue.mapLinear(d,-.1,.1,(r=l==null?void 0:l[0])!==null&&r!==void 0?r:-.1,(m=l==null?void 0:l[1])!==null&&m!==void 0?m:.1),a.current.position.y=d*s,a.current.updateMatrix()}),u.createElement("group",y,u.createElement("group",{ref:xn([a,v]),matrixAutoUpdate:!1},e))}),Ae={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},ir="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",st=e=>Array.isArray(e);function Ot({files:e=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:t="",preset:o=void 0,encoding:i=void 0,extensions:s}={}){var l,y,v;let a=null,g=!1,n;if(o){if(!(o in Ae))throw new Error("Preset must be one of: "+Object.keys(Ae).join(", "));e=Ae[o],t=ir}if(g=st(e),n=st(e)?"cube":e.startsWith("data:application/exr")?"exr":e.startsWith("data:application/hdr")?"hdr":(l=e.split(".").pop())==null||(y=l.split("?"))==null||(v=y.shift())==null?void 0:v.toLowerCase(),a=g?tn:n==="hdr"?En:n==="exr"?_n:null,!a)throw new Error("useEnvironment: Unrecognized file extension: "+e);const r=se(a,g?[e]:e,w=>{w.setPath==null||w.setPath(t),s&&s(w)}),m=g?r[0]:r;m.mapping=g?Qt:en;const f=3001,d=3e3;return"colorSpace"in m?m.colorSpace=i??g?"srgb":"srgb-linear":m.encoding=i??g?f:d,m}const sr=e=>e.current&&e.current.isScene,ar=e=>sr(e)?e.current:e;function qe(e,t,o,i,s=0){const l=ar(t||o),y=l.background,v=l.environment,a=l.backgroundBlurriness||0;return e!=="only"&&(l.environment=i),e&&(l.background=i),e&&l.backgroundBlurriness!==void 0&&(l.backgroundBlurriness=s),()=>{e!=="only"&&(l.environment=v),e&&(l.background=y),e&&l.backgroundBlurriness!==void 0&&(l.backgroundBlurriness=a)}}function Ue({scene:e,background:t=!1,blur:o,map:i}){const s=q(l=>l.scene);return u.useLayoutEffect(()=>{if(i)return qe(t,e,s,i,o)},[s,e,i,t,o]),null}function Tt({background:e=!1,scene:t,blur:o,...i}){const s=Ot(i),l=q(y=>y.scene);return u.useLayoutEffect(()=>qe(e,t,l,s,o),[s,e,t,l,o]),null}function lr({children:e,near:t=1,far:o=1e3,resolution:i=256,frames:s=1,map:l,background:y=!1,blur:v,scene:a,files:g,path:n,preset:r=void 0,extensions:m}){const f=q(b=>b.gl),d=q(b=>b.scene),w=u.useRef(null),[h]=u.useState(()=>new De),c=u.useMemo(()=>{const b=new nn(i);return b.texture.type=rn,b},[i]);u.useLayoutEffect(()=>(s===1&&w.current.update(f,h),qe(y,a,d,c.texture,v)),[e,h,c.texture,a,d,y,s,f]);let p=1;return we(()=>{(s===1/0||p<s)&&(w.current.update(f,h),p++)}),u.createElement(u.Fragment,null,Un(u.createElement(u.Fragment,null,e,u.createElement("cubeCamera",{ref:w,args:[t,o,c]}),g||r?u.createElement(Tt,{background:!0,files:g,preset:r,path:n,extensions:m}):l?u.createElement(Ue,{background:!0,map:l,extensions:m}):null),h))}function cr(e){var t,o,i,s;const l=Ot(e),y=e.map||l;u.useMemo(()=>dt({GroundProjectedEnvImpl:Mn}),[]);const v=u.useMemo(()=>[y],[y]),a=(t=e.ground)==null?void 0:t.height,g=(o=e.ground)==null?void 0:o.radius,n=(i=(s=e.ground)==null?void 0:s.scale)!==null&&i!==void 0?i:1e3;return u.createElement(u.Fragment,null,u.createElement(Ue,J({},e,{map:y})),u.createElement("groundProjectedEnvImpl",{args:v,scale:n,height:a,radius:g}))}function kr(e){return e.ground?u.createElement(cr,e):e.map?u.createElement(Ue,e):e.children?u.createElement(lr,e):u.createElement(Tt,e)}const jr=u.forwardRef(({scale:e=10,frames:t=1/0,opacity:o=1,width:i=1,height:s=1,blur:l=1,near:y=0,far:v=10,resolution:a=512,smooth:g=!0,color:n="#000000",depthWrite:r=!1,renderOrder:m,...f},d)=>{const w=u.useRef(null),h=q(I=>I.scene),c=q(I=>I.gl),p=u.useRef(null);i=i*(Array.isArray(e)?e[0]:e||1),s=s*(Array.isArray(e)?e[1]:e||1);const[b,M,P,_,x,S,C]=u.useMemo(()=>{const I=new Ye(a,a),L=new Ye(a,a);L.texture.generateMipmaps=I.texture.generateMipmaps=!1;const G=new on(i,s).rotateX(Math.PI/2),F=new sn(G),B=new an;B.depthTest=B.depthWrite=!1,B.onBeforeCompile=A=>{A.uniforms={...A.uniforms,ucolor:{value:new at(n)}},A.fragmentShader=A.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),A.fragmentShader=A.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const U=new Ke(Pn),H=new Ke(Cn);return H.depthTest=U.depthTest=!1,[I,G,B,F,U,H,L]},[a,i,s,e,n]),R=I=>{_.visible=!0,_.material=x,x.uniforms.tDiffuse.value=b.texture,x.uniforms.h.value=I*1/256,c.setRenderTarget(C),c.render(_,p.current),_.material=S,S.uniforms.tDiffuse.value=C.texture,S.uniforms.v.value=I*1/256,c.setRenderTarget(b),c.render(_,p.current),_.visible=!1};let E=0,O,$;return we(()=>{p.current&&(t===1/0||E<t)&&(E++,O=h.background,$=h.overrideMaterial,w.current.visible=!1,h.background=null,h.overrideMaterial=P,c.setRenderTarget(b),c.render(h,p.current),R(l),g&&R(l*.4),c.setRenderTarget(null),w.current.visible=!0,h.overrideMaterial=$,h.background=O)}),u.useImperativeHandle(d,()=>w.current,[]),u.createElement("group",J({"rotation-x":Math.PI/2},f,{ref:w}),u.createElement("mesh",{renderOrder:m,geometry:M,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},u.createElement("meshBasicMaterial",{transparent:!0,map:b.texture,opacity:o,depthWrite:r})),u.createElement("orthographicCamera",{ref:p,args:[-i/2,i/2,s/2,-s/2,y,v]}))});export{jr as C,kr as E,Tr as F,Sr as H,Rr as P,Or as T,Cr as a,ee as b,Rt as c,xr as d,q as u};
//# sourceMappingURL=@react-three-fda88cb4.js.map
