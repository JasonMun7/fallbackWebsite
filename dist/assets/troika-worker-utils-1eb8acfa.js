function M(){var e=Object.create(null);function a(n,t){var i=n.id,o=n.name,u=n.dependencies;u===void 0&&(u=[]);var r=n.init;r===void 0&&(r=function(){});var f=n.getTransferables;if(f===void 0&&(f=null),!e[i])try{u=u.map(function(s){return s&&s.isWorkerModule&&(a(s,function(g){if(g instanceof Error)throw g}),s=e[s.id].value),s}),r=c("<"+o+">.init",r),f&&(f=c("<"+o+">.getTransferables",f));var d=null;typeof r=="function"?d=r.apply(void 0,u):console.error("worker module init function failed to rehydrate"),e[i]={id:i,value:d,getTransferables:f},t(d)}catch(s){s&&s.noLog||console.error(s),t(s)}}function l(n,t){var i,o=n.id,u=n.args;(!e[o]||typeof e[o].value!="function")&&t(new Error("Worker module "+o+": not found or its 'init' did not return a function"));try{var r=(i=e[o]).value.apply(i,u);r&&typeof r.then=="function"?r.then(f,function(d){return t(d instanceof Error?d:new Error(""+d))}):f(r)}catch(d){t(d)}function f(d){try{var s=e[o].getTransferables&&e[o].getTransferables(d);(!s||!Array.isArray(s)||!s.length)&&(s=void 0),t(d,s)}catch(g){console.error(g),t(g)}}}function c(n,t){var i=void 0;self.troikaDefine=function(u){return i=u};var o=URL.createObjectURL(new Blob(["/** "+n.replace(/\*/g,"")+` **/

troikaDefine(
`+t+`
)`],{type:"application/javascript"}));try{importScripts(o)}catch(u){console.error(u)}return URL.revokeObjectURL(o),delete self.troikaDefine,i}self.addEventListener("message",function(n){var t=n.data,i=t.messageId,o=t.action,u=t.data;try{o==="registerModule"&&a(u,function(r){r instanceof Error?postMessage({messageId:i,success:!1,error:r.message}):postMessage({messageId:i,success:!0,result:{isCallable:typeof r=="function"}})}),o==="callModule"&&l(u,function(r,f){r instanceof Error?postMessage({messageId:i,success:!1,error:r.message}):postMessage({messageId:i,success:!0,result:r},f||void 0)})}catch(r){postMessage({messageId:i,success:!1,error:r.stack})}})}function b(e){var a=function(){for(var l=[],c=arguments.length;c--;)l[c]=arguments[c];return a._getInitResult().then(function(n){if(typeof n=="function")return n.apply(void 0,l);throw new Error("Worker module function was called but `init` did not return a callable function")})};return a._getInitResult=function(){var l=e.dependencies,c=e.init;l=Array.isArray(l)?l.map(function(t){return t&&t._getInitResult?t._getInitResult():t}):[];var n=Promise.all(l).then(function(t){return c.apply(null,t)});return a._getInitResult=function(){return n},n},a}var h=function(){var e=!1;if(typeof window<"u"&&typeof window.document<"u")try{var a=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));a.terminate(),e=!0}catch(l){typeof process<"u",console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+l.message+"]")}return h=function(){return e},e},I=0,W=0,p=!1,v=Object.create(null),m=Object.create(null),y=Object.create(null);function E(e){if((!e||typeof e.init!="function")&&!p)throw new Error("requires `options.init` function");var a=e.dependencies,l=e.init,c=e.getTransferables,n=e.workerId;if(!h())return b(e);n==null&&(n="#default");var t="workerModule"+ ++I,i=e.name||t,o=null;a=a&&a.map(function(r){return typeof r=="function"&&!r.workerModuleData&&(p=!0,r=E({workerId:n,name:"<"+i+"> function dependency: "+r.name,init:`function(){return (
`+w(r)+`
)}`}),p=!1),r&&r.workerModuleData&&(r=r.workerModuleData),r});function u(){for(var r=[],f=arguments.length;f--;)r[f]=arguments[f];if(!o){o=k(n,"registerModule",u.workerModuleData);var d=function(){o=null,m[n].delete(d)};(m[n]||(m[n]=new Set)).add(d)}return o.then(function(s){var g=s.isCallable;if(g)return k(n,"callModule",{id:t,args:r});throw new Error("Worker module function was called but `init` did not return a callable function")})}return u.workerModuleData={isWorkerModule:!0,id:t,name:i,dependencies:a,init:w(l),getTransferables:c&&w(c)},u}function T(e){m[e]&&m[e].forEach(function(a){a()}),v[e]&&(v[e].terminate(),delete v[e])}function w(e){var a=e.toString();return!/^function/.test(a)&&/^\w+\s*\(/.test(a)&&(a="function "+a),a}function R(e){var a=v[e];if(!a){var l=w(M);a=v[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+` **/

;(`+l+")()"],{type:"application/javascript"}))),a.onmessage=function(c){var n=c.data,t=n.messageId,i=y[t];if(!i)throw new Error("WorkerModule response with empty or unknown messageId");delete y[t],i(n)}}return a}function k(e,a,l){return new Promise(function(c,n){var t=++W;y[t]=function(i){i.success?c(i.result):n(new Error("Error in worker "+a+" call: "+i.error))},R(e).postMessage({messageId:t,action:a,data:l})})}export{E as d,T as t};
//# sourceMappingURL=troika-worker-utils-1eb8acfa.js.map
